CREATE PROCEDURE PRINSPECTIONCHECKITEMSCOMPANYCOPY  
(  
    @ROWUSERCODE  INT  
 , @INSPECTIONID  UNIQUEIDENTIFIER  
 , @FROMCOMPANYID  INT  ---ESM(16)  
 , @TOCOMPANYID  INT  ---ESMPVT(20)  
)  
AS   
BEGIN  
   
  
 DECLARE @INSPECTIONNAME VARCHAR(200)  
 DECLARE @INSREVISIONID  UNIQUEIDENTIFIER  
 DECLARE @TOINSREVISIONID  UNIQUEIDENTIFIER  
 DECLARE @TOINSPECTIONID  UNIQUEIDENTIFIER  
 DECLARE @TOINSREVID   UNIQUEIDENTIFIER  
  
 SELECT @INSPECTIONNAME=FLDINSPECTIONNAME,@INSREVISIONID=FLDREVISIONID  
 FROM TBLINSPECTION (NOLOCK)  
 WHERE FLDINSPECTIONID = @INSPECTIONID  
 AND FLDCOMPANYID = @FROMCOMPANYID  
  
 SELECT @TOINSPECTIONID = FLDINSPECTIONID  
    ,@TOINSREVISIONID = FLDREVISIONID  
 FROM TBLINSPECTION  
 WHERE FLDINSPECTIONNAME = @INSPECTIONNAME  
 AND FLDCOMPANYID = @TOCOMPANYID  
  
 DECLARE @APPROVEDDATE DATETIME  
 DECLARE @REVISIONNUMBER INT  
  
 SELECT @APPROVEDDATE = FLDAPPROVEDDATE  
  ,@REVISIONNUMBER = FLDREVISIONNUMBER  
  ,@TOINSREVID = FLDINSPECTIONREVISIONID  
 FROM TBLINSPECTIONREVISION (NOLOCK)  
 WHERE FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  
  
 IF @TOINSPECTIONID IS NULL  
 BEGIN  
  
  EXEC PRNEWSEQUENTIALID @TOINSPECTIONID OUT  
  EXEC PRNEWSEQUENTIALID @TOINSREVISIONID OUT  
  
     INSERT INTO  TBLINSPECTION  
     (  
         FLDINSPECTIONID  
      , FLDINSPECTIONTYPEID  
      , FLDINSPECTIONCATEGORYID  
      , FLDINSPECTIONNAME  
      , FLDSHORTCODE  
      , FLDACTIVEYN  
      , FLDEFFECTIVEDATE  
      , FLDCREATEDDATE  
      , FLDCREATEDBY  
      , FLDMODIFIEDDATE  
      , FLDMODIFIEDBY  
      , FLDEXTERNALAUDITTYPE  
      , FLDOFFICEYN  
      , FLDCOMPANYID  
      , FLDFREQUENCYINMONTHS  
      , FLDADDTOSCHEDULE  
      , FLDWINDOWPERIODBEFORE  
      , FLDWINDOWPERIODAFTER  
      , FLDFIRSTREMINDER  
      , FLDSECONDREMINDER  
      , FLDINSPECTIONTYPE  
      , FLDQUESTIONTYPE  
      , FLDASSESSMENTSTANDARDS  
      , FLDSIXLETTERCODE  
      , FLDWINDOWBEFORE4AUDIT  
      , FLDWINDOWAFTER4AUDIT  
      , FLDQUARTERLYYN  
      , FLDTYPE     
      , FLDDEFAULTREPORT      
      , FLDPLANREQUIREDYN  
      , FLDCERTIFICATIONREQUIREDYN   
      , FLDGRANULARASSESSMENTYN  
      , FLDREVISIONID  
      , FLDSCHEDULEFREQUENCYTYPE  
      , FLDCHECKLISTYN  
      , FLDDEFICIENCYTYPE  
      , FLDSINGLEUSERYN  
      , FLDVESSELOVERVIEWYN  
      , FLDPRIMARYREVIEW  
      , FLDSECONDARYREVIEW  
      , FLDINITIALIZEFROM   
   , FLDREPORTFINDINGSYN     
   , FLDREPORTUNSAFEACTSYN     
   , FLDPRIMARYREVIEWERTITLE    
   , FLDSECONDARYREVIEWERTITLE    
   , FLDAREAOFIMPROVEMENTYN    
   , FLDNCCOUNTONFRONTPAGEYN    
   , FLDOWNERSREPORTSELECTION    
   , FLDDATEYN        
   , FLDPARAMYN       
   , FLDJOBYN        
   , FLDPHOTOYN       
   , FLDDOCUMENTSYN      
   , FLDSUPDTJOBYN       
   , FLDVESSELTYPELIST      
   , FLDWEEKCHECKSYN      
   , FLDMASTERLISTYN      
   , FLDISCREWCHANGEPLAN     
   , FLDINSPECTIONCERTIFICATEYN   
   , FLDHEADERNOTE       
   , FLDINSPECTIONPLANTYPE     
     )  
   OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTION  
     SELECT  
       @TOINSPECTIONID  
      , FLDINSPECTIONTYPEID  
      , FLDINSPECTIONCATEGORYID  
      , FLDINSPECTIONNAME  
      , FLDSHORTCODE  
      , FLDACTIVEYN  
      , FLDEFFECTIVEDATE  
      , GETUTCDATE()  
      , @ROWUSERCODE  
      , GETUTCDATE()  
      , @ROWUSERCODE  
      , FLDEXTERNALAUDITTYPE  
      , FLDOFFICEYN  
      , @TOCOMPANYID  
      , FLDFREQUENCYINMONTHS  
      , FLDADDTOSCHEDULE  
      , FLDWINDOWPERIODBEFORE  
      , FLDWINDOWPERIODAFTER  
      , FLDFIRSTREMINDER  
      , FLDSECONDREMINDER  
      , FLDINSPECTIONTYPE  
      , FLDQUESTIONTYPE  
      , FLDASSESSMENTSTANDARDS  
      , FLDSIXLETTERCODE  
      , FLDWINDOWBEFORE4AUDIT  
      , FLDWINDOWAFTER4AUDIT  
      , FLDQUARTERLYYN  
      , FLDTYPE     
      , FLDDEFAULTREPORT      
      , FLDPLANREQUIREDYN  
      , FLDCERTIFICATIONREQUIREDYN   
      , FLDGRANULARASSESSMENTYN  
      , @TOINSREVISIONID  
      , FLDSCHEDULEFREQUENCYTYPE  
      , FLDCHECKLISTYN  
      , FLDDEFICIENCYTYPE  
     , FLDSINGLEUSERYN  
      , FLDVESSELOVERVIEWYN  
      , FLDPRIMARYREVIEW  
      , FLDSECONDARYREVIEW  
      , FLDINITIALIZEFROM  
   , FLDREPORTFINDINGSYN     
   , FLDREPORTUNSAFEACTSYN     
   , FLDPRIMARYREVIEWERTITLE    
   , FLDSECONDARYREVIEWERTITLE    
   , FLDAREAOFIMPROVEMENTYN    
   , FLDNCCOUNTONFRONTPAGEYN    
   , FLDOWNERSREPORTSELECTION    
   , FLDDATEYN        
   , FLDPARAMYN       
   , FLDJOBYN        
   , FLDPHOTOYN       
   , FLDDOCUMENTSYN      
   , FLDSUPDTJOBYN       
   , FLDVESSELTYPELIST      
   , FLDWEEKCHECKSYN      
   , FLDMASTERLISTYN      
   , FLDISCREWCHANGEPLAN     
   , FLDINSPECTIONCERTIFICATEYN   
   , FLDHEADERNOTE       
   , FLDINSPECTIONPLANTYPE          
  FROM TBLINSPECTION (NOLOCK)  
  WHERE FLDINSPECTIONID= @INSPECTIONID  
 END  
 ELSE   
 BEGIN  
 UPDATE T   
  
       SET  FLDINSPECTIONTYPEID   = F.FLDINSPECTIONTYPEID    
   , FLDINSPECTIONCATEGORYID  = F.FLDINSPECTIONCATEGORYID     
   , FLDMODIFIEDDATE    = GETUTCDATE()  
   , FLDMODIFIEDBY     = @ROWUSERCODE  
   , FLDEXTERNALAUDITTYPE   = F.FLDEXTERNALAUDITTYPE       
   , FLDFREQUENCYINMONTHS   = F.FLDFREQUENCYINMONTHS     
   , FLDADDTOSCHEDULE    = F.FLDADDTOSCHEDULE      
   , FLDWINDOWPERIODBEFORE   = F.FLDWINDOWPERIODBEFORE     
   , FLDWINDOWPERIODAFTER   = F.FLDWINDOWPERIODAFTER     
   --, FLDFIRSTREMINDER    = F.FLDFIRSTREMINDER      
   --, FLDSECONDREMINDER    = F.FLDSECONDREMINDER      
   --, FLDACTIVEINSPECTIONID   = F.FLDACTIVEINSPECTIONID     
   , FLDINSPECTIONTYPE    = F.FLDINSPECTIONTYPE      
   , FLDQUESTIONTYPE    = F.FLDQUESTIONTYPE      
   , FLDASSESSMENTSTANDARDS  = F.FLDASSESSMENTSTANDARDS    
   , FLDSIXLETTERCODE    = F.FLDSIXLETTERCODE      
   , FLDWINDOWBEFORE4AUDIT   = F.FLDWINDOWBEFORE4AUDIT     
   , FLDWINDOWAFTER4AUDIT   = F.FLDWINDOWAFTER4AUDIT     
   , FLDQUARTERLYYN    = F.FLDQUARTERLYYN      
   , FLDTYPE      = F.FLDTYPE         
   , FLDDEFAULTREPORT    = F.FLDDEFAULTREPORT       
   , FLDPLANREQUIREDYN    = F.FLDPLANREQUIREDYN       
   , FLDCERTIFICATIONREQUIREDYN = F.FLDCERTIFICATIONREQUIREDYN     
   , FLDGRANULARASSESSMENTYN  = F.FLDGRANULARASSESSMENTYN    
   , FLDSCHEDULEFREQUENCYTYPE  = F.FLDSCHEDULEFREQUENCYTYPE    
   , FLDCHECKLISTYN    = F.FLDCHECKLISTYN      
   , FLDDEFICIENCYTYPE    = F.FLDDEFICIENCYTYPE      
   , FLDSINGLEUSERYN               = F.FLDSINGLEUSERYN                 
   , FLDVESSELOVERVIEWYN   = F.FLDVESSELOVERVIEWYN     
   , FLDPRIMARYREVIEW    = F.FLDPRIMARYREVIEW      
   , FLDSECONDARYREVIEW   = F.FLDSECONDARYREVIEW  
   , FLDINITIALIZEFROM    = F.FLDINITIALIZEFROM   
   , FLDREPORTFINDINGSYN   = F.FLDREPORTFINDINGSYN  
   , FLDREPORTUNSAFEACTSYN   = F.FLDREPORTUNSAFEACTSYN  
   , FLDPRIMARYREVIEWERTITLE  = F.FLDPRIMARYREVIEWERTITLE  
   , FLDSECONDARYREVIEWERTITLE  = F.FLDSECONDARYREVIEWERTITLE  
   , FLDAREAOFIMPROVEMENTYN  = F.FLDAREAOFIMPROVEMENTYN  
   , FLDNCCOUNTONFRONTPAGEYN  = F.FLDNCCOUNTONFRONTPAGEYN  
   , FLDOWNERSREPORTSELECTION  = F.FLDOWNERSREPORTSELECTION  
   , FLDDATEYN      = F.FLDDATEYN  
   , FLDPARAMYN     = F.FLDPARAMYN  
   , FLDJOBYN      = F.FLDJOBYN  
   , FLDPHOTOYN     = F.FLDPHOTOYN  
   , FLDDOCUMENTSYN    = F.FLDDOCUMENTSYN  
   , FLDSUPDTJOBYN     = F.FLDSUPDTJOBYN  
   , FLDVESSELTYPELIST    = F.FLDVESSELTYPELIST  
   , FLDWEEKCHECKSYN    = F.FLDWEEKCHECKSYN  
   , FLDMASTERLISTYN    = F.FLDMASTERLISTYN  
   , FLDISCREWCHANGEPLAN   = F.FLDISCREWCHANGEPLAN  
   , FLDINSPECTIONCERTIFICATEYN = F.FLDINSPECTIONCERTIFICATEYN  
   , FLDHEADERNOTE     = F.FLDHEADERNOTE  
   , FLDINSPECTIONPLANTYPE   = F.FLDINSPECTIONPLANTYPE  
  OUTPUT 1, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID),NULL,  INSERTED.* INTO TBLAUDITINSPECTION  
  FROM TBLINSPECTION T  
   INNER JOIN TBLINSPECTION F (NOLOCK)  
    ON T.FLDINSPECTIONNAME = F.FLDINSPECTIONNAME  
    AND F.FLDCOMPANYID = @FROMCOMPANYID  
    AND T.FLDCOMPANYID = @TOCOMPANYID  
  WHERE T.FLDINSPECTIONID = @TOINSPECTIONID  
  AND T.FLDCOMPANYID = @TOCOMPANYID  
  
 END   
  
 IF (@APPROVEDDATE IS NOT NULL OR @TOINSREVID IS NULL)  
 BEGIN  
  
   
  EXEC PRNEWSEQUENTIALID @TOINSREVISIONID OUT  
  
  
   INSERT INTO TBLINSPECTIONREVISION  
    (  
      FLDINSPECTIONREVISIONID  
  ,FLDINSPECTIONID  
  ,FLDREVISEDDATE  
  ,FLDREVISEDBY  
  ,FLDREVISIONNUMBER  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
  ,FLDSTATUS  
  ,FLDINSPECTIONTYPEID    
  ,FLDINSPECTIONCATEGORYID   
  ,FLDINSPECTIONNAME     
  ,FLDSHORTCODE      
  ,FLDOFFICEYN      
  ,FLDEXTERNALAUDITTYPE    
  ,FLDFREQUENCYINMONTHS    
  ,FLDADDTOSCHEDULE     
  ,FLDWINDOWPERIODBEFORE    
  ,FLDWINDOWPERIODAFTER    
  ,FLDFIRSTREMINDER     
  ,FLDSECONDREMINDER     
  ,FLDACTIVEINSPECTIONID    
  ,FLDINSPECTIONTYPE     
  ,FLDDEFICIENCYCATEGORY    
  ,FLDCHECKITEM      
  ,FLDQUESTIONTYPE     
  ,FLDASSESSMENTSTANDARDS    
  ,FLDSIXLETTERCODE     
  ,FLDWINDOWBEFORE4AUDIT    
  ,FLDWINDOWAFTER4AUDIT    
  ,FLDQUARTERLYYN      
  ,FLDTYPE       
  ,FLDDEFAULTREPORT     
  ,FLDPLANREQUIREDYN     
  ,FLDCERTIFICATIONREQUIREDYN   
  ,FLDGRANULARASSESSMENTYN   
  ,FLDSCHEDULEFREQUENCYTYPE  
  ,FLDCHECKLISTYN  
  ,FLDDEFICIENCYTYPE  
  ,FLDSINGLEUSERYN  
  ,FLDVESSELOVERVIEWYN  
  ,FLDINSPECTIONPLANTYPE  
  ,FLDPRIMARYREVIEW  
  ,FLDSECONDARYREVIEW  
  ,FLDINITIALIZEFROM  
  ,FLDMASTERLISTYN  
  ,FLDWEEKCHECKSYN  
  ,FLDISCREWCHANGEPLAN  
  ,FLDINSPECTIONCERTIFICATEYN  
  ,FLDHEADERNOTE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONREVISION  
 SELECT   
     @TOINSREVISIONID  
  ,@TOINSPECTIONID  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,ISNULL(@REVISIONNUMBER+1,0)  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
  ,0  
  ,FLDINSPECTIONTYPEID    
  ,FLDINSPECTIONCATEGORYID   
  ,FLDINSPECTIONNAME     
  ,FLDSHORTCODE      
  ,FLDOFFICEYN      
  ,FLDEXTERNALAUDITTYPE    
  ,FLDFREQUENCYINMONTHS    
  ,FLDADDTOSCHEDULE     
  ,FLDWINDOWPERIODBEFORE    
  ,FLDWINDOWPERIODAFTER    
  ,FLDFIRSTREMINDER     
  ,FLDSECONDREMINDER     
  ,FLDACTIVEINSPECTIONID    
  ,FLDINSPECTIONTYPE     
  ,FLDDEFICIENCYCATEGORY    
  ,FLDCHECKITEM      
  ,FLDQUESTIONTYPE     
  ,FLDASSESSMENTSTANDARDS    
  ,FLDSIXLETTERCODE     
  ,FLDWINDOWBEFORE4AUDIT    
  ,FLDWINDOWAFTER4AUDIT    
  ,FLDQUARTERLYYN      
  ,FLDTYPE       
  ,FLDDEFAULTREPORT     
  ,FLDPLANREQUIREDYN     
  ,FLDCERTIFICATIONREQUIREDYN   
  ,FLDGRANULARASSESSMENTYN   
  ,FLDSCHEDULEFREQUENCYTYPE  
  ,FLDCHECKLISTYN  
  ,FLDDEFICIENCYTYPE  
  ,FLDSINGLEUSERYN  
  ,FLDVESSELOVERVIEWYN  
  ,FLDINSPECTIONPLANTYPE  
  ,FLDPRIMARYREVIEW  
  ,FLDSECONDARYREVIEW  
  ,FLDINITIALIZEFROM  
  ,FLDMASTERLISTYN  
  ,FLDWEEKCHECKSYN  
  ,FLDISCREWCHANGEPLAN  
  ,FLDINSPECTIONCERTIFICATEYN  
  ,FLDHEADERNOTE  
 FROM  TBLINSPECTION  (NOLOCK)  
 WHERE FLDINSPECTIONID= @TOINSPECTIONID  
  
 UPDATE TBLINSPECTION  
 SET FLDREVISIONID =@TOINSREVISIONID  
 OUTPUT 1, @ROWUSERCODE, DATEADD(MM,2,GETUTCDATE()), OBJECT_NAME(@@PROCID),NULL,  INSERTED.* INTO TBLAUDITINSPECTION  
 WHERE FLDINSPECTIONID = @TOINSPECTIONID  
  
 END  
 ELSE  
 BEGIN  
  UPDATE T   
  SET     FLDMODIFIEDBY                  = @ROWUSERCODE  
    ,FLDMODIFIEDDATE                = GETUTCDATE()  
    ,FLDEXTERNALAUDITTYPE   = TM.FLDEXTERNALAUDITTYPE     
    ,FLDINSPECTIONTYPEID   = TM.FLDINSPECTIONTYPEID     
    ,FLDINSPECTIONCATEGORYID  = TM.FLDINSPECTIONCATEGORYID    
    ,FLDINSPECTIONNAME    = TM.FLDINSPECTIONNAME      
    ,FLDSHORTCODE     = TM.FLDSHORTCODE       
    ,FLDOFFICEYN     = TM.FLDOFFICEYN       
    ,FLDFREQUENCYINMONTHS   = TM.FLDFREQUENCYINMONTHS     
    ,FLDADDTOSCHEDULE    = TM.FLDADDTOSCHEDULE      
    ,FLDWINDOWPERIODBEFORE   = TM.FLDWINDOWPERIODBEFORE     
    ,FLDWINDOWPERIODAFTER   = TM.FLDWINDOWPERIODAFTER     
    ,FLDFIRSTREMINDER    = TM.FLDFIRSTREMINDER      
    ,FLDSECONDREMINDER    = TM.FLDSECONDREMINDER      
    ,FLDACTIVEINSPECTIONID   = TM.FLDACTIVEINSPECTIONID     
    ,FLDINSPECTIONTYPE    = TM.FLDINSPECTIONTYPE      
    ,FLDQUESTIONTYPE    = TM.FLDQUESTIONTYPE      
    ,FLDASSESSMENTSTANDARDS   = TM.FLDASSESSMENTSTANDARDS     
    ,FLDSIXLETTERCODE    = TM.FLDSIXLETTERCODE      
    ,FLDWINDOWBEFORE4AUDIT   = TM.FLDWINDOWBEFORE4AUDIT     
    ,FLDWINDOWAFTER4AUDIT   = TM.FLDWINDOWAFTER4AUDIT     
    ,FLDQUARTERLYYN     = TM.FLDQUARTERLYYN       
    ,FLDTYPE      = TM.FLDTYPE         
    ,FLDDEFAULTREPORT    = TM.FLDDEFAULTREPORT       
    ,FLDPLANREQUIREDYN    = TM.FLDPLANREQUIREDYN       
    ,FLDCERTIFICATIONREQUIREDYN  = TM.FLDCERTIFICATIONREQUIREDYN     
    ,FLDGRANULARASSESSMENTYN  = TM.FLDGRANULARASSESSMENTYN    
    ,FLDSCHEDULEFREQUENCYTYPE  = TM.FLDSCHEDULEFREQUENCYTYPE    
    ,FLDCHECKLISTYN     = TM.FLDCHECKLISTYN       
    ,FLDDEFICIENCYTYPE    = TM.FLDDEFICIENCYTYPE      
    ,FLDSINGLEUSERYN                = TM.FLDSINGLEUSERYN                  
    ,FLDVESSELOVERVIEWYN   = TM.FLDVESSELOVERVIEWYN  
    ,FLDPRIMARYREVIEW    = TM.FLDPRIMARYREVIEW      
    ,FLDSECONDARYREVIEW    = TM.FLDSECONDARYREVIEW      
    ,FLDINITIALIZEFROM    = TM.FLDINITIALIZEFROM    
    ,FLDSTATUS      = 0  
    ,FLDREVISEDDATE     = GETUTCDATE()  
    ,FLDREVISEDBY     = @ROWUSERCODE  
    ,FLDREVISIONNUMBER    = ISNULL(@REVISIONNUMBER,0)  
    ,FLDMASTERLISTYN    = TM.FLDMASTERLISTYN  
    ,FLDWEEKCHECKSYN    = TM.FLDWEEKCHECKSYN  
    ,FLDISCREWCHANGEPLAN   = TM.FLDISCREWCHANGEPLAN  
    ,FLDINSPECTIONCERTIFICATEYN  = TM.FLDINSPECTIONCERTIFICATEYN  
    ,FLDHEADERNOTE     = TM.FLDHEADERNOTE  
  OUTPUT 1, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID),NULL,  INSERTED.* INTO TBLAUDITINSPECTIONREVISION  
  FROM TBLINSPECTIONREVISION T  
   INNER JOIN TBLINSPECTION TM (NOLOCK)  
    ON T.FLDINSPECTIONID = TM.FLDINSPECTIONID  
    AND T.FLDINSPECTIONREVISIONID = TM.FLDREVISIONID  
  WHERE T.FLDINSPECTIONID = @TOINSPECTIONID  
 END  
----1.CHAPTER  
    DECLARE @TEMPCHAPTER TABLE   
 (  
     FLDCHAPTERID            UNIQUEIDENTIFIER  
   , FLDTOCHAPTERID            UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   , FLDCHAPTERREVISIONID    UNIQUEIDENTIFIER  
   , FLDTOCHAPTERREVISIONID    UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
      , FLDINSPECTIONID            UNIQUEIDENTIFIER  
   , FLDCHAPTERNAME             NVARCHAR(1000)  
   , FLDFROMPARENTID            UNIQUEIDENTIFIER  
   , FLDTOPARENTID            UNIQUEIDENTIFIER  
 )  
 INSERT INTO @TEMPCHAPTER  
 (  
  FLDCHAPTERID  
 ,FLDINSPECTIONID  
 ,FLDCHAPTERREVISIONID  
 ,FLDCHAPTERNAME  
 ,FLDFROMPARENTID  
 )  
 SELECT  
  FLDCHAPTERID  
 ,FLDINSPECTIONID  
 ,FLDCHAPTERREVISIONID  
 ,FLDCHAPTERNAME  
 ,FLDPARENTID  
 FROM TBLINSPECTIONCHAPTER (NOLOCK)  
 WHERE  FLDINSPECTIONID = @INSPECTIONID  
  
  
 UPDATE T  
 SET FLDTOCHAPTERID = C.FLDCHAPTERID  
  ,FLDTOCHAPTERREVISIONID = C.FLDCHAPTERREVISIONID  
 FROM @TEMPCHAPTER T  
  INNER JOIN TBLINSPECTIONCHAPTER C (NOLOCK)  
   ON T.FLDCHAPTERNAME = C.FLDCHAPTERNAME  
   AND C.FLDINSPECTIONID = @TOINSPECTIONID  
 WHERE T.FLDCHAPTERNAME = C.FLDCHAPTERNAME  
 AND C.FLDINSPECTIONID = @TOINSPECTIONID  
  
 UPDATE T  
 SET FLDTOPARENTID = P.FLDTOCHAPTERID  
 FROM @TEMPCHAPTER T  
  INNER JOIN @TEMPCHAPTER P  
   ON T.FLDFROMPARENTID = P.FLDCHAPTERID  
 WHERE T.FLDFROMPARENTID = P.FLDCHAPTERID  
  
  UPDATE TC  
  SET    
   FLDCHAPTERREVISIONID   = T.FLDTOCHAPTERREVISIONID  
  , FLDCHAPTERNAME    = FC.FLDCHAPTERNAME   
  , FLDMODIFIEDDATE    = GETUTCDATE()  
  , FLDMODIFIEDBY     = @ROWUSERCODE  
  , FLDSORTORDER     = FC.FLDSORTORDER  
  , FLDDEFICIENCYCATEGORY   = FC.FLDDEFICIENCYCATEGORY  
  , FLDDEFICIENCYCATEGORYNAME  = FC.FLDDEFICIENCYCATEGORYNAME  
  , FLDDEFICIENCYSUBCATEGORY  = FC.FLDDEFICIENCYSUBCATEGORY  
  , FLDDEFICIENCYSUBCATEGORYNAME = FC.FLDDEFICIENCYSUBCATEGORYNAME  
  , FLDPARENTID     = T.FLDTOPARENTID  
  , FLDDEFICIENCYCATEGORYIDLIST = FC.FLDDEFICIENCYCATEGORYIDLIST  
  , FLDCAHPTERSORTORDER   = dbo.FNDOCUMENTSECTIONNUMBERSORT(TC.FLDCHAPTERNUMBER)  
  , FLDISPARENTYN     = FC.FLDISPARENTYN      
        , FLDISVESSELTYPESPECIFIED  = FC.FLDISVESSELTYPESPECIFIED   
        , FLDVESSELTYPESPECIFIEDLIST = FC.FLDVESSELTYPESPECIFIEDLIST  
  , FLDREVISEDDATE    = GETUTCDATE()  
  , FLDREVISIONID                 = @TOINSREVISIONID       
 OUTPUT 1, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID),NULL,  INSERTED.* INTO TBLAUDITINSPECTIONCHAPTER  
     FROM  TBLINSPECTIONCHAPTER TC (NOLOCK)  
     INNER JOIN @TEMPCHAPTER T  
  ON T.FLDTOCHAPTERID = TC.FLDCHAPTERID  
     INNER JOIN TBLINSPECTIONCHAPTER FC (NOLOCK)  
  ON T.FLDCHAPTERID = FC.FLDCHAPTERID  
 WHERE T.FLDTOCHAPTERID = TC.FLDCHAPTERID  
  
  
 INSERT INTO TBLINSPECTIONCHAPTER  
 (  
    FLDCHAPTERID  
         ,FLDINSPECTIONID  
         ,FLDCHAPTERNUMBER  
         ,FLDCHAPTERNAME  
         ,FLDCREATEDDATE  
         ,FLDCREATEDBY  
         ,FLDMODIFIEDDATE  
         ,FLDMODIFIEDBY  
         ,FLDPARENTID  
         ,FLDSORTORDER  
         ,FLDDEFICIENCYCATEGORY  
         ,FLDDEFICIENCYCATEGORYNAME  
         ,FLDDEFICIENCYSUBCATEGORY  
         ,FLDDEFICIENCYSUBCATEGORYNAME  
         ,FLDREVISIONID  
         ,FLDREVISEDDATE  
         ,FLDDEFICIENCYCATEGORYIDLIST  
         ,FLDCAHPTERSORTORDER  
         ,FLDCHAPTERREVISIONID  
         ,FLDISPARENTYN  
         ,FLDISVESSELTYPESPECIFIED  
         ,FLDVESSELTYPESPECIFIEDLIST  
 )  
 OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONCHAPTER  
 SELECT T.FLDTOCHAPTERID  
            ,@TOINSPECTIONID  
            ,FC.FLDCHAPTERNUMBER  
            ,FC.FLDCHAPTERNAME  
            ,GETUTCDATE()  
            ,@ROWUSERCODE  
            ,GETUTCDATE()  
            ,@ROWUSERCODE  
            ,T.FLDTOPARENTID  
            ,FC.FLDSORTORDER  
            ,FC.FLDDEFICIENCYCATEGORY  
            ,FC.FLDDEFICIENCYCATEGORYNAME  
            ,FC.FLDDEFICIENCYSUBCATEGORY  
            ,FC.FLDDEFICIENCYSUBCATEGORYNAME  
            ,@TOINSREVISIONID  
            ,GETUTCDATE()  
            ,FC.FLDDEFICIENCYCATEGORYIDLIST  
            ,FC.FLDCAHPTERSORTORDER  
            ,T.FLDTOCHAPTERREVISIONID  
            ,FC.FLDISPARENTYN  
            ,FC.FLDISVESSELTYPESPECIFIED  
            ,FC.FLDVESSELTYPESPECIFIEDLIST   
 FROM @TEMPCHAPTER T  
  INNER JOIN TBLINSPECTIONCHAPTER FC (NOLOCK)  
  ON T.FLDCHAPTERID = FC.FLDCHAPTERID  
 LEFT JOIN TBLINSPECTIONCHAPTER TC (NOLOCK)  
  ON T.FLDTOCHAPTERID = TC.FLDCHAPTERID  
 WHERE TC.FLDCHAPTERID IS NULL  
  
   
    UPDATE TCR  
    SET   
        FLDCHAPTERID      = T.FLDTOCHAPTERID  
       , FLDCHAPTERNUMBER     = FC.FLDCHAPTERNUMBER     
       , FLDCHAPTERNAME      = FC.FLDCHAPTERNAME      
       , FLDSORTORDER      = FC.FLDSORTORDER      
       , FLDDEFICIENCYCATEGORY    = FC.FLDDEFICIENCYCATEGORY    
       , FLDDEFICIENCYCATEGORYNAME   = FC.FLDDEFICIENCYCATEGORYNAME   
       , FLDREVISIONNUMBER     = FC.FLDREVISIONNUMBER     
       , FLDMODIFIEDDATE     = GETUTCDATE()  
    , FLDMODIFIEDBY      = @ROWUSERCODE  
       , FLDPARENTID      = T.FLDTOPARENTID      
       , FLDREVISIONID      = @TOINSREVISIONID     
       , FLDDEFICIENCYCATEGORYIDLIST  = FC.FLDDEFICIENCYCATEGORYIDLIST  
       , FLDCAHPTERSORTORDER    = FC.FLDCAHPTERSORTORDER    
       , FLDREVISEDDATE      = GETUTCDATE()      
       , FLDREVISEDBY      = @ROWUSERCODE      
       , FLDAPPROVEDBY      = NULL     
       , FLDAPPROVEDDATE     = NULL     
       , FLDLATESTREVISIONYN    = FC.FLDLATESTREVISIONYN    
       , FLDISPARENTYN      = FC.FLDISPARENTYN      
       , FLDISVESSELTYPESPECIFIED   = FC.FLDISVESSELTYPESPECIFIED   
       , FLDVESSELTYPESPECIFIEDLIST   = FC.FLDVESSELTYPESPECIFIEDLIST  
   OUTPUT 1,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONCHAPTERREVISION  
     FROM  TBLINSPECTIONCHAPTERREVISION TCR   
    INNER JOIN @TEMPCHAPTER T  
     ON T.FLDTOCHAPTERREVISIONID = TCR.FLDINSPECTIONCHAPTERREVISIONID  
     INNER JOIN TBLINSPECTIONCHAPTERREVISION FC (NOLOCK)  
     ON T.FLDCHAPTERREVISIONID = FC.FLDINSPECTIONCHAPTERREVISIONID  
    WHERE  T.FLDCHAPTERREVISIONID = FC.FLDINSPECTIONCHAPTERREVISIONID  
  AND T.FLDTOCHAPTERREVISIONID = TCR.FLDINSPECTIONCHAPTERREVISIONID  
   
 INSERT INTO TBLINSPECTIONCHAPTERREVISION   
 (  
    FLDINSPECTIONCHAPTERREVISIONID  
      ,FLDCHAPTERID  
      ,FLDCHAPTERNUMBER  
      ,FLDCHAPTERNAME  
      ,FLDSORTORDER  
      ,FLDDEFICIENCYCATEGORY  
      ,FLDDEFICIENCYCATEGORYNAME  
      ,FLDREVISIONNUMBER  
      ,FLDCREATEDDATE  
      ,FLDCREATEDBY  
      ,FLDMODIFIEDDATE  
      ,FLDMODIFIEDBY  
      ,FLDPARENTID  
      ,FLDREVISIONID  
      ,FLDDEFICIENCYCATEGORYIDLIST  
      ,FLDCAHPTERSORTORDER  
      ,FLDREVISEDDATE  
      ,FLDREVISEDBY  
      ,FLDLATESTREVISIONYN  
      ,FLDISPARENTYN  
      ,FLDISVESSELTYPESPECIFIED  
      ,FLDVESSELTYPESPECIFIEDLIST  
 )  
 OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONCHAPTERREVISION  
 SELECT   
   
  T.FLDTOCHAPTERREVISIONID  
      ,T.FLDTOCHAPTERID  
     ,FC.FLDCHAPTERNUMBER  
     ,FC.FLDCHAPTERNAME  
     ,FC.FLDSORTORDER  
     ,FC.FLDDEFICIENCYCATEGORY  
     ,FC.FLDDEFICIENCYCATEGORYNAME  
     ,FC.FLDREVISIONNUMBER  
     ,GETUTCDATE()  
     ,@ROWUSERCODE  
     ,GETUTCDATE()  
     ,@ROWUSERCODE  
     ,T.FLDTOPARENTID  
     ,@TOINSREVISIONID  
     ,FC.FLDDEFICIENCYCATEGORYIDLIST  
     ,FC.FLDCAHPTERSORTORDER  
     ,GETUTCDATE()  
     ,@ROWUSERCODE  
     ,FC.FLDLATESTREVISIONYN  
     ,FC.FLDISPARENTYN  
     ,FC.FLDISVESSELTYPESPECIFIED  
     ,FC.FLDVESSELTYPESPECIFIEDLIST   
 FROM  @TEMPCHAPTER T  
  INNER JOIN TBLINSPECTIONCHAPTERREVISION FC (NOLOCK)  
  ON T.FLDCHAPTERREVISIONID = FC.FLDINSPECTIONCHAPTERREVISIONID  
 LEFT JOIN TBLINSPECTIONCHAPTERREVISION TC (NOLOCK)  
  ON T.FLDTOCHAPTERREVISIONID = TC.FLDINSPECTIONCHAPTERREVISIONID  
 WHERE TC.FLDINSPECTIONCHAPTERREVISIONID IS NULL  
  
 ------16.TBLINSPECTIONCHAPTEREXTENSION  
  
  DECLARE @TEMPCHAPTEREXTENSION TABLE  
  (  
   FLDINSPECTIONCHAPTEREXTENSIONID  UNIQUEIDENTIFIER  
   ,FLDTOINSPECTIONCHAPTEREXTENSIONID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDINSPECTIONREVISIONID   UNIQUEIDENTIFIER   
   ,FLDTOINSPECTIONREVISIONID   UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDCHAPTERID      UNIQUEIDENTIFIER  
   ,FLDTOCHAPTERID      UNIQUEIDENTIFIER  
   ,FLDCHAPTERIDREVISIONID    UNIQUEIDENTIFIER   
   ,FLDTOCHAPTERIDREVISIONID   UNIQUEIDENTIFIER  
  )  
  
 INSERT INTO @TEMPCHAPTEREXTENSION  
 (   
  FLDINSPECTIONCHAPTEREXTENSIONID   
 ,FLDINSPECTIONREVISIONID      
 ,FLDCHAPTERID     
 ,FLDCHAPTERIDREVISIONID     
 ,FLDTOCHAPTERID  
 ,FLDTOCHAPTERIDREVISIONID  
 ,FLDTOINSPECTIONREVISIONID  
  
 )  
 SELECT   
  E.FLDINSPECTIONCHAPTEREXTENSIONID   
 ,E.FLDINSPECTIONREVISIONID      
 ,E.FLDCHAPTERID     
 ,E.FLDCHAPTERREVISIONID        
 ,T.FLDTOCHAPTERID  
 ,T.FLDTOCHAPTERREVISIONID  
 ,@TOINSREVISIONID  
 FROM TBLINSPECTIONCHAPTEREXTENSION E (NOLOCK)  
  INNER JOIN @TEMPCHAPTER T   
   ON E.FLDCHAPTERID = T.FLDCHAPTERID  
   AND E.FLDCHAPTERREVISIONID = T.FLDCHAPTERREVISIONID  
 WHERE  FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
 UPDATE T  
 SET  FLDTOINSPECTIONCHAPTEREXTENSIONID  = C.FLDINSPECTIONCHAPTEREXTENSIONID  
 FROM @TEMPCHAPTEREXTENSION T  
  INNER JOIN TBLINSPECTIONCHAPTEREXTENSION C (NOLOCK)  
   ON T.FLDTOCHAPTERID = C.FLDCHAPTERID  
   AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
   AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
 WHERE T.FLDTOCHAPTERID = C.FLDCHAPTERID  
 AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
 AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  
 INSERT INTO TBLINSPECTIONCHAPTEREXTENSION  
 (  
  FLDINSPECTIONCHAPTEREXTENSIONID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDCHAPTERID  
  ,FLDCHAPTERREVISIONID  
  ,FLDISCHECKITEMLEVELREGULATIONYN  
  ,FLDREGULATIONNOTE  
  ,FLDCHAPTERNOTE  
  ,FLDMULTICOLUMNYN  
  ,FLDMULTICOLUMNCOUNT  
  ,FLDFOOTERCONFIGYN  
  ,FLDCHECKSVERIFIEDLIST  
  ,FLDCHECKSCARRIEDLIST  
  ,FLDCHECKSFOOTERLIST  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
  ,FLDSETREPORTSEPERATEPAGE  
  ,FLDISCHECKITEMLEVELCOMPONENTREQUIRED  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONCHAPTEREXTENSION  
 SELECT T.FLDTOINSPECTIONCHAPTEREXTENSIONID  
  ,T.FLDTOINSPECTIONREVISIONID  
  ,T.FLDTOCHAPTERID  
  ,T.FLDTOCHAPTERIDREVISIONID  
  ,FC.FLDISCHECKITEMLEVELREGULATIONYN  
  ,FC.FLDREGULATIONNOTE  
  ,FC.FLDCHAPTERNOTE  
  ,FC.FLDMULTICOLUMNYN  
  ,FC.FLDMULTICOLUMNCOUNT  
  ,FC.FLDFOOTERCONFIGYN  
  ,FC.FLDCHECKSVERIFIEDLIST  
  ,FC.FLDCHECKSCARRIEDLIST  
  ,FC.FLDCHECKSFOOTERLIST  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,FC.FLDSETREPORTSEPERATEPAGE  
  ,FC.FLDISCHECKITEMLEVELCOMPONENTREQUIRED  
 FROM @TEMPCHAPTEREXTENSION  T  
  INNER JOIN TBLINSPECTIONCHAPTEREXTENSION FC (NOLOCK)  
  ON T.FLDINSPECTIONCHAPTEREXTENSIONID = FC.FLDINSPECTIONCHAPTEREXTENSIONID  
 LEFT JOIN TBLINSPECTIONCHAPTEREXTENSION TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHAPTEREXTENSIONID = TC.FLDINSPECTIONCHAPTEREXTENSIONID  
 WHERE TC.FLDINSPECTIONCHAPTEREXTENSIONID IS NULL  
  
-- ------3.CHECKLIST  
  
 DECLARE @TEMPCHECKLIST TABLE   
 (  
   FLDEXTERNALINSPECTIONCHECKITEMID  UNIQUEIDENTIFIER  
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONREVISIONID    UNIQUEIDENTIFIER   
  ,FLDTOINSPECTIONREVISIONID    UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDREFERENCEID      UNIQUEIDENTIFIER  
  ,FLDTOREFERENCEID      UNIQUEIDENTIFIER  
  ,FLDREVISIONID       UNIQUEIDENTIFIER   
  ,FLDTOREVISIONID      UNIQUEIDENTIFIER  
  ,FLDITEM         VARCHAR(500)  
  ,FLDREFERENCENUMBER     VARCHAR(50)  
             
 )  
 INSERT INTO @TEMPCHECKLIST  
 (   
  FLDEXTERNALINSPECTIONCHECKITEMID   
 ,FLDINSPECTIONREVISIONID      
 ,FLDREFERENCEID     
 ,FLDREVISIONID        
 ,FLDITEM   
 ,FLDREFERENCENUMBER  
 ,FLDTOREFERENCEID  
 ,FLDTOREVISIONID  
 ,FLDTOINSPECTIONREVISIONID  
  
 )  
 SELECT   
  E.FLDEXTERNALINSPECTIONCHECKITEMID   
 ,E.FLDINSPECTIONREVISIONID      
 ,E.FLDREFERENCEID     
 ,E.FLDREVISIONID        
 ,E.FLDITEM    
 ,E.FLDREFERENCENUMBER  
 ,T.FLDTOCHAPTERID  
 ,T.FLDTOCHAPTERREVISIONID  
 ,@TOINSREVISIONID  
 FROM TBLEXTERNALINSPECTIONCHECKITEM E (NOLOCK)  
  INNER JOIN @TEMPCHAPTER T   
   ON E.FLDREFERENCEID = T.FLDCHAPTERID  
   AND E.FLDREVISIONID = T.FLDCHAPTERREVISIONID  
 WHERE  FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
  
 UPDATE T  
 SET  FLDTOEXTERNALINSPECTIONCHECKITEMID  = C.FLDEXTERNALINSPECTIONCHECKITEMID  
 FROM @TEMPCHECKLIST T  
  INNER JOIN TBLEXTERNALINSPECTIONCHECKITEM C (NOLOCK)  
   ON T.FLDITEM = C.FLDITEM  
   AND T.FLDREFERENCENUMBER = C.FLDREFERENCENUMBER  
   AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  INNER JOIN @TEMPCHAPTER TC  
   ON TC.FLDTOCHAPTERID = C.FLDREFERENCEID  
   AND TC.FLDTOCHAPTERREVISIONID = C.FLDREVISIONID  
 WHERE T.FLDITEM = C.FLDITEM  
 AND T.FLDREFERENCENUMBER = C.FLDREFERENCENUMBER  
 AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  
 UPDATE T  
 SET  FLDTOREFERENCEID            = TC.FLDTOCHAPTERID  
  ,FLDTOREVISIONID            = TC.FLDTOCHAPTERREVISIONID  
 FROM @TEMPCHECKLIST T  
  INNER JOIN @TEMPCHAPTER TC  
   ON TC.FLDCHAPTERID = T.FLDREFERENCEID  
   AND TC.FLDCHAPTERREVISIONID = T.FLDREVISIONID  
 WHERE TC.FLDCHAPTERID = T.FLDREFERENCEID  
 AND TC.FLDCHAPTERREVISIONID = T.FLDREVISIONID  
  
  
  INSERT INTO TBLEXTERNALINSPECTIONCHECKITEM  
  (  
   FLDEXTERNALINSPECTIONCHECKITEMID  
   ,FLDREFERENCEID  
   ,FLDREVISIONID  
   ,FLDPARENTITEMID  
   ,FLDINSPECTIONREVISIONID  
   ,FLDREFERENCENUMBER  
   ,FLDPSCCODE  
   ,FLDITEM  
   ,FLDDESCRIPTION  
   ,FLDGUIDENCENOTE  
   ,FLDCOMPANYID  
   ,FLDDEFICIENCYCATEGORYID  
   ,FLDDEFICIENCYCATEGORYNAME  
   ,FLDDEFICIENCYSUBCATEGORYID  
   ,FLDMAPPEDJOBSYN  
   ,FLDSTATICYN  
   ,FLDPHOTOREQUIREDYN  
   ,FLDPHOTODESCRIPITION  
   ,FLDLASTDONEDATEFROMPMSYN  
   ,FLDEFFECTIVEFROMDATE  
   ,FLDDMSYN  
   ,FLDPMSYN  
   ,FLDFMSYN  
   ,FLDRAYN  
   ,FLDOTHERSYN  
   ,FLDUNDERAUDITITEMYN  
   ,FLDRESPONSIBILITYID  
   ,FLDFLAGYN  
   ,FLDACTIVEYN  
   ,FLDJOBPARAMETERYN  
   ,FLDVESSELTYPEYN  
   ,FLDPRINCIPALYN   
   ,FLDCLIENTYN  
   ,FLDPARENTCHAPTERID  
   ,FLDPERSONALCHECKYN  
   ,FLDCREATEDBY  
   ,FLDCREATEDATE  
   ,FLDMODIFIEDBY  
   ,FLDMODIFIEDDATE  
   ,FLDROTATIONALYN  
   ,FLDRISKLEVELQUESTIONNAIRE  
   ,FLDAGEOFVESSEL  
   ,FLDSTARTDATE  
   ,FLDENDDATE  
   ,FLDGRANULARASSESSMENTYN  
   ,FLDCATEGORY  
   ,FLDAPPLICABLEGROUPRANKS  
   ,FLDVIQCODE  
   ,FLDCDICODE  
   ,FLDTMSACODE  
   ,FLDSORTORDER  
   ,FLDPHOTOMAPCOUNT  
   ,FLDLASTDONEDATEMAPCOUNT  
   ,FLDPARAMETERSMAPCOUNT  
   ,FLDJOBSMAPCOUNT  
   ,FLDEVIDENCEMAPCOUNT  
   ,FLDEXTDOCUMENTMAPCOUNT  
   ,FLDMULTICOLUMNYN  
   ,FLDMULTICOLUMNCOUNT  
   ,FLDRIGHTSHIP  
   ,FLDROVIQ  
   ,FLDCOMPONENTJOBSYN  
   ,FLDDOCUMENTMAPCOUNT  
  )  
   OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITEXTERNALINSPECTIONCHECKITEM  
  SELECT  
    
    T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
   ,T.FLDTOREFERENCEID  
   ,T.FLDTOREVISIONID  
   ,FC.FLDPARENTITEMID  
   ,@TOINSREVISIONID  
   ,FC.FLDREFERENCENUMBER  
   ,FC.FLDPSCCODE  
   ,T.FLDITEM  
   ,FC.FLDDESCRIPTION  
   ,FC.FLDGUIDENCENOTE  
   ,@TOCOMPANYID  
   ,FC.FLDDEFICIENCYCATEGORYID  
   ,FC.FLDDEFICIENCYCATEGORYNAME  
   ,FC.FLDDEFICIENCYSUBCATEGORYID  
   ,FC.FLDMAPPEDJOBSYN  
   ,FC.FLDSTATICYN  
   ,FC.FLDPHOTOREQUIREDYN  
   ,FC.FLDPHOTODESCRIPITION  
   ,FC.FLDLASTDONEDATEFROMPMSYN  
   ,FC.FLDEFFECTIVEFROMDATE  
   ,FC.FLDDMSYN  
   ,FC.FLDPMSYN  
   ,FC.FLDFMSYN  
   ,FC.FLDRAYN  
   ,FC.FLDOTHERSYN  
   ,FC.FLDUNDERAUDITITEMYN  
   ,FC.FLDRESPONSIBILITYID  
   ,FC.FLDFLAGYN  
   ,FC.FLDACTIVEYN  
   ,FC.FLDJOBPARAMETERYN  
   ,FC.FLDVESSELTYPEYN  
   ,FC.FLDPRINCIPALYN   
   ,FC.FLDCLIENTYN  
   ,FC.FLDPARENTCHAPTERID  
   ,FC.FLDPERSONALCHECKYN  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,FC.FLDROTATIONALYN  
   ,FC.FLDRISKLEVELQUESTIONNAIRE  
   ,FC.FLDAGEOFVESSEL  
   ,FC.FLDSTARTDATE  
   ,FC.FLDENDDATE  
   ,FC.FLDGRANULARASSESSMENTYN  
   ,FC.FLDCATEGORY  
   ,FC.FLDAPPLICABLEGROUPRANKS  
   ,FC.FLDVIQCODE  
   ,FC.FLDCDICODE  
   ,FC.FLDTMSACODE  
   ,FC.FLDSORTORDER  
   ,FC.FLDPHOTOMAPCOUNT  
   ,FC.FLDLASTDONEDATEMAPCOUNT  
   ,FC.FLDPARAMETERSMAPCOUNT  
   ,FC.FLDJOBSMAPCOUNT  
   ,FC.FLDEVIDENCEMAPCOUNT  
   ,FC.FLDEXTDOCUMENTMAPCOUNT  
   ,FC.FLDMULTICOLUMNYN  
   ,FC.FLDMULTICOLUMNCOUNT  
   ,FC.FLDRIGHTSHIP  
   ,FC.FLDROVIQ  
   ,FC.FLDCOMPONENTJOBSYN  
   ,FC.FLDDOCUMENTMAPCOUNT  
 FROM @TEMPCHECKLIST T  
  INNER JOIN TBLEXTERNALINSPECTIONCHECKITEM FC (NOLOCK)  
  ON T.FLDEXTERNALINSPECTIONCHECKITEMID = FC.FLDEXTERNALINSPECTIONCHECKITEMID  
 LEFT JOIN TBLEXTERNALINSPECTIONCHECKITEM TC (NOLOCK)  
  ON T.FLDTOEXTERNALINSPECTIONCHECKITEMID = TC.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE TC.FLDEXTERNALINSPECTIONCHECKITEMID IS NULL  
  
  
-- -----4.CHECKITEM PHOTO  
  
 DECLARE @TEMPPHOTO TABLE   
 ( FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID  UNIQUEIDENTIFIER  
   ,FLDTOEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDEXTERNALINSPECTIONCHECKITEMID     UNIQUEIDENTIFIER  
   ,FLDTOEXTERNALINSPECTIONCHECKITEMID    UNIQUEIDENTIFIER  
      ,FLDCAPTIONNAME         VARCHAR (200)  
 )  
 INSERT INTO @TEMPPHOTO  
 (  
 FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID  
 ,FLDCAPTIONNAME  
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID       
 )  
 SELECT   
  P.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID  
 ,P.FLDCAPTIONNAME  
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID       
 FROM  
 TBLEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
  
 UPDATE T  
 SET FLDTOEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID = C.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID  
 FROM @TEMPPHOTO T  
  INNER JOIN TBLEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION C (NOLOCK)  
   ON T.FLDCAPTIONNAME = C.FLDCAPTIONNAME  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID = C.FLDEXTERNALINSPECTIONCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
     
  
  
 INSERT INTO TBLEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION  
   (  
    FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID  
    ,FLDEXTERNALINSPECTIONCHECKITEMID  
    ,FLDCAPTIONNAME  
    ,FLDMANDATORYYN  
    ,FLDTYPE  
    ,FLDCREATEDBY  
    ,FLDCREATEDDATE  
    ,FLDMODIFIEDBY  
    ,FLDMODIFIEDDATE  
   )  
  OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION  
   SELECT   
     
     T.FLDTOEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID      
    ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
    ,T.FLDCAPTIONNAME  
    ,FC.FLDMANDATORYYN  
    ,FC.FLDTYPE  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
     
   FROM @TEMPPHOTO T  
  INNER JOIN TBLEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION FC (NOLOCK)  
  ON T.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID = FC.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID  
 LEFT JOIN TBLEXTERNALINSPECTIONCHECKITEMPHOTOCAPTION TC (NOLOCK)  
  ON T.FLDTOEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID = TC.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID  
 WHERE TC.FLDEXTERNALINSPECTIONCHECKITEMPHOTOCAPTIONID IS NULL  
  
-- -----5.PARAMATER  
  
 DECLARE @TEMPPARAMETER TABLE   
 (  FLDCHECKITEMPARAMETERID  UNIQUEIDENTIFIER  
   ,FLDTOCHECKITEMPARAMETERID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDEXTERNALCHECKITEMID  UNIQUEIDENTIFIER  
   ,FLDTOEXTERNALCHECKITEMID     UNIQUEIDENTIFIER   
   ,FLDTOJOBID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDJOBID      UNIQUEIDENTIFIER  
      ,FLDPARAMETERNAME    VARCHAR (200)  
   ,FLDPARAMETERCODE             VARCHAR (20)  
   ,FLDJOBCODE     VARCHAR (50)  
      ,FLDJOBNAME     VARCHAR (200)  
 )  
   
 INSERT INTO @TEMPPARAMETER  
 (  
  FLDCHECKITEMPARAMETERID   
 ,FLDEXTERNALCHECKITEMID  
 ,FLDPARAMETERNAME   
 ,FLDPARAMETERCODE  
 ,FLDJOBID  
 ,FLDJOBCODE      
 ,FLDJOBNAME   
 ,FLDTOEXTERNALCHECKITEMID  
 )  
 SELECT   
  P.FLDCHECKITEMPARAMETERID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID  
 ,P.FLDPARAMETERNAME   
 ,P.FLDPARAMETERCODE  
 ,P.FLDJOBID    
 ,P.FLDJOBCODE      
 ,P.FLDJOBNAME   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM TBLINSPECTIONEXTERNALCHECKITEMSPARAMETER P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
  
 UPDATE T  
 SET FLDTOCHECKITEMPARAMETERID  = C.FLDCHECKITEMPARAMETERID  
  ,FLDTOJOBID          = C.FLDJOBID  
 FROM @TEMPPARAMETER T  
  INNER JOIN TBLINSPECTIONEXTERNALCHECKITEMSPARAMETER C (NOLOCK)  
   ON T.FLDPARAMETERNAME  = C.FLDPARAMETERNAME  
    AND T.FLDJOBNAME      = C.FLDJOBNAME  
    AND T.FLDTOEXTERNALCHECKITEMID = C.FLDEXTERNALCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
     
  
   INSERT INTO TBLINSPECTIONEXTERNALCHECKITEMSPARAMETER  
 (  
   FLDCHECKITEMPARAMETERID      
  ,FLDEXTERNALCHECKITEMID    
  ,FLDCOMPONENTID  
  ,FLDCOMPONENTNUMBER  
  ,FLDCOMPONENTNAME  
  ,FLDJOBID  
  ,FLDJOBCODE  
  ,FLDJOBNAME  
  ,FLDPARAMETERCODE       
  ,FLDPARAMETERNAME       
  ,FLDISACTIVE        
  ,FLDCREATEDBY        
  ,FLDCREATEDDATE        
  ,FLDMODIFIEDBY        
  ,FLDMODIFIEDDATE       
  ,FLDPARAMETERTYPE  
  ,FLDISPARAMETER  
  ,FLDREQUIREDLASTDONEDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONEXTERNALCHECKITEMSPARAMETER  
 SELECT  
   T.FLDTOCHECKITEMPARAMETERID   
  ,T.FLDTOEXTERNALCHECKITEMID    
  ,FC.FLDCOMPONENTID  
  ,FC.FLDCOMPONENTNUMBER  
  ,FC.FLDCOMPONENTNAME  
  ,T.FLDJOBID  
  ,T.FLDJOBCODE  
  ,T.FLDJOBNAME  
  ,T.FLDPARAMETERCODE      
  ,T.FLDPARAMETERNAME      
  ,FC.FLDISACTIVE       
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,FC.FLDPARAMETERTYPE  
  ,FC.FLDISPARAMETER  
  ,FC.FLDREQUIREDLASTDONEDATE  
   
   FROM @TEMPPARAMETER T  
  INNER JOIN TBLINSPECTIONEXTERNALCHECKITEMSPARAMETER FC (NOLOCK)  
  ON T.FLDCHECKITEMPARAMETERID = FC.FLDCHECKITEMPARAMETERID  
 LEFT JOIN TBLINSPECTIONEXTERNALCHECKITEMSPARAMETER TC (NOLOCK)  
  ON T.FLDTOCHECKITEMPARAMETERID = TC.FLDCHECKITEMPARAMETERID  
 WHERE TC.FLDCHECKITEMPARAMETERID IS NULL  
  
--------6.OTHERSCHECKITEMMAPPING  
  
 DECLARE @TEMPOTHERSCHECKITEMMAPPING TABLE   
 (  
   FLDINSPECTIONOTHERSCHECKITEMMAPPINGID  UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONOTHERSCHECKITEMMAPPINGID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDEXTERNALINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID  UNIQUEIDENTIFIER   
  ,FLDREFERENCEID          UNIQUEIDENTIFIER  
  ,FLDTYPE                                   SMALLINT  
 )  
 INSERT INTO @TEMPOTHERSCHECKITEMMAPPING  
 (   
  FLDINSPECTIONOTHERSCHECKITEMMAPPINGID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID      
 ,FLDREFERENCEID     
 ,FLDTYPE   
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID     
 ,P.FLDREFERENCEID     
 ,P.FLDTYPE   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM  
 TBLINSPECTIONOTHERSCHECKITEMMAPPING P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
  
  
 UPDATE T  
 SET FLDTOINSPECTIONOTHERSCHECKITEMMAPPINGID = C.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID  
 FROM @TEMPOTHERSCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONOTHERSCHECKITEMMAPPING C (NOLOCK)  
   ON T.FLDTYPE = C.FLDTYPE  
   AND T.FLDREFERENCEID = C.FLDREFERENCEID  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID=C.FLDEXTERNALINSPECTIONCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
  
  
 INSERT INTO TBLINSPECTIONOTHERSCHECKITEMMAPPING  
   (  
     FLDINSPECTIONOTHERSCHECKITEMMAPPINGID  
    ,FLDEXTERNALINSPECTIONCHECKITEMID  
    ,FLDREFERENCEID  
    ,FLDTYPE  
    ,FLDCREATEDBY  
    ,FLDCREATEDDATE  
    ,FLDMODIFIEDBY  
    ,FLDMODIFIEDDATE  
    )   
    OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL, INSERTED.* INTO TBLAUDITINSPECTIONOTHERSCHECKITEMMAPPING  
    SELECT  
        T.FLDTOINSPECTIONOTHERSCHECKITEMMAPPINGID  
    ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
    ,T.FLDREFERENCEID  
    ,FC.FLDTYPE  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
   FROM @TEMPOTHERSCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONOTHERSCHECKITEMMAPPING FC (NOLOCK)  
  ON T.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID = FC.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID  
 LEFT JOIN TBLINSPECTIONOTHERSCHECKITEMMAPPING TC (NOLOCK)  
  ON T.FLDTOINSPECTIONOTHERSCHECKITEMMAPPINGID = TC.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID  
 WHERE TC.FLDINSPECTIONOTHERSCHECKITEMMAPPINGID IS NULL  
  
  
-------7.DMSCHECKITEMMAPPING  
  
 DECLARE @TEMPDMSCHECKITEMMAPPING TABLE   
 (  
   FLDINSPECTIONDMSCHECKITEMSMAPPINGID  UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONDMSCHECKITEMSMAPPINGID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDEXTERNALINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDREFERENCEID          UNIQUEIDENTIFIER  
  ,FLDTYPE                                   SMALLINT  
             
 )  
 INSERT INTO @TEMPDMSCHECKITEMMAPPING  
 (   
  FLDINSPECTIONDMSCHECKITEMSMAPPINGID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID      
 ,FLDREFERENCEID     
 ,FLDTYPE   
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONDMSCHECKITEMSMAPPINGID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID     
 ,P.FLDREFERENCEID     
 ,P.FLDTYPE   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM  
 TBLINSPECTIONDMSCHECKITEMMAPPING P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE C.FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
  
 UPDATE T  
 SET   FLDINSPECTIONDMSCHECKITEMSMAPPINGID   = C.FLDINSPECTIONDMSCHECKITEMSMAPPINGID  
 FROM @TEMPDMSCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONDMSCHECKITEMMAPPING C (NOLOCK)  
   ON T.FLDTYPE = C.FLDTYPE  
   AND T.FLDREFERENCEID = C.FLDREFERENCEID  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID=C.FLDEXTERNALINSPECTIONCHECKITEMID  
  INNER JOIN TBLEXTERNALINSPECTIONCHECKITEM EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
  
  
  
INSERT INTO TBLINSPECTIONDMSCHECKITEMMAPPING  
   (  
     FLDINSPECTIONDMSCHECKITEMSMAPPINGID  
    ,FLDEXTERNALINSPECTIONCHECKITEMID  
    ,FLDREFERENCEID  
    ,FLDTYPE  
    ,FLDCREATEDBY  
    ,FLDCREATEDDATE  
    ,FLDMODIFIEDBY  
    ,FLDMODIFIEDDATE  
    )   
    OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL, INSERTED.* INTO TBLAUDITINSPECTIONDMSCHECKITEMMAPPING  
    SELECT  
        T.FLDTOINSPECTIONDMSCHECKITEMSMAPPINGID  
    ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
    ,T.FLDREFERENCEID  
    ,T.FLDTYPE  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
    ,@ROWUSERCODE  
    ,GETUTCDATE()  
   FROM @TEMPDMSCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONDMSCHECKITEMMAPPING FC (NOLOCK)  
  ON T.FLDINSPECTIONDMSCHECKITEMSMAPPINGID = FC.FLDINSPECTIONDMSCHECKITEMSMAPPINGID  
 LEFT JOIN TBLINSPECTIONDMSCHECKITEMMAPPING TC (NOLOCK)  
  ON T.FLDTOINSPECTIONDMSCHECKITEMSMAPPINGID = TC.FLDINSPECTIONDMSCHECKITEMSMAPPINGID  
 WHERE TC.FLDINSPECTIONDMSCHECKITEMSMAPPINGID IS NULL  
  
  
-------8.EXTERNALDOCUMENT  
  
 DECLARE @TEMPEXTERNALDOCUMENT TABLE   
 (  
   FLDINSPECTIONEXTERNALDOCUMENTID   UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONEXTERNALDOCUMENTID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDTOINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDEXTERNALDOCUMENTNAME           VARCHAR(200)  
 )  
  
 INSERT INTO @TEMPEXTERNALDOCUMENT  
 (   
  FLDINSPECTIONEXTERNALDOCUMENTID    
  ,FLDINSPECTIONCHECKITEMID        
  ,FLDEXTERNALDOCUMENTNAME    
  ,FLDTOINSPECTIONCHECKITEMID  
 )  
 SELECT   
   P.FLDINSPECTIONEXTERNALDOCUMENTID    
  ,C.FLDEXTERNALINSPECTIONCHECKITEMID        
  ,P.FLDEXTERNALDOCUMENTNAME   
  ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM TBLINSPECTIONEXTERNALDOCUMENT P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDINSPECTIONCHECKITEMID  
 WHERE C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
   
  
 UPDATE T  
 SET   FLDTOINSPECTIONEXTERNALDOCUMENTID   = C.FLDINSPECTIONEXTERNALDOCUMENTID  
 FROM @TEMPEXTERNALDOCUMENT T  
  INNER JOIN TBLINSPECTIONEXTERNALDOCUMENT C (NOLOCK)  
   ON T.FLDEXTERNALDOCUMENTNAME = C.FLDEXTERNALDOCUMENTNAME  
   AND T.FLDTOINSPECTIONCHECKITEMID = C.FLDINSPECTIONEXTERNALDOCUMENTID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDINSPECTIONCHECKITEMID  
  
   
  
  INSERT INTO TBLINSPECTIONEXTERNALDOCUMENT  
  (  
   FLDINSPECTIONEXTERNALDOCUMENTID  
   ,FLDINSPECTIONCHECKITEMID  
   ,FLDEXTERNALDOCUMENTNAME  
   ,FLDNOTE  
   ,FLDSORTORDER  
   ,FLDCREATEDBY  
   ,FLDCREATEDDATE  
   ,FLDMODIFIEDBY  
   ,FLDMODIFIEDDATE  
  )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONEXTERNALDOCUMENT  
  SELECT   
    T.FLDTOINSPECTIONEXTERNALDOCUMENTID  
   ,T.FLDTOINSPECTIONCHECKITEMID  
   ,T.FLDEXTERNALDOCUMENTNAME  
   ,FC.FLDNOTE  
   ,FC.FLDSORTORDER  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
  FROM @TEMPEXTERNALDOCUMENT T  
  INNER JOIN TBLINSPECTIONEXTERNALDOCUMENT FC (NOLOCK)  
  ON T.FLDINSPECTIONEXTERNALDOCUMENTID = FC.FLDINSPECTIONEXTERNALDOCUMENTID  
 LEFT JOIN TBLINSPECTIONEXTERNALDOCUMENT TC (NOLOCK)  
  ON T.FLDTOINSPECTIONEXTERNALDOCUMENTID = TC.FLDINSPECTIONEXTERNALDOCUMENTID  
 WHERE TC.FLDINSPECTIONEXTERNALDOCUMENTID IS NULL  
  
  
--------9.CHECKITEMEVIDENCE  
   
 DECLARE @TEMPCHECKITEMEVIDENCE TABLE   
 (  
   FLDINSPECTIONCHECKITEMEVIDENCEID   UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONCHECKITEMEVIDENCEID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONCHECKITEMID    UNIQUEIDENTIFIER   
  ,FLDTOINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDEVIDENCENAME                    VARCHAR(200)  
 )  
 INSERT INTO @TEMPCHECKITEMEVIDENCE  
 (   
  FLDINSPECTIONCHECKITEMEVIDENCEID    
  ,FLDINSPECTIONCHECKITEMID        
  ,FLDEVIDENCENAME    
  ,FLDTOINSPECTIONCHECKITEMID  
 )  
 SELECT   
   P.FLDINSPECTIONCHECKITEMEVIDENCEID    
  ,C.FLDEXTERNALINSPECTIONCHECKITEMID        
  ,P.FLDEVIDENCENAME   
  ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM  
 TBLINSPECTIONCHECKITEMEVIDENCE P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDINSPECTIONCHECKITEMID  
 WHERE C.FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
  
 UPDATE T  
 SET   FLDINSPECTIONCHECKITEMEVIDENCEID   = C.FLDINSPECTIONCHECKITEMEVIDENCEID  
    
 FROM @TEMPCHECKITEMEVIDENCE T  
  INNER JOIN TBLINSPECTIONCHECKITEMEVIDENCE C (NOLOCK)  
   ON T.FLDEVIDENCENAME = C.FLDEVIDENCENAME  
   AND T.FLDTOINSPECTIONCHECKITEMID = C.FLDINSPECTIONCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDINSPECTIONCHECKITEMID  
  
   
  
INSERT INTO TBLINSPECTIONCHECKITEMEVIDENCE  
  (  
   FLDINSPECTIONCHECKITEMEVIDENCEID  
   ,FLDINSPECTIONCHECKITEMID  
   ,FLDEVIDENCENAME  
   ,FLDSORTORDER  
   ,FLDCREATEDBY  
   ,FLDCREATEDDATE  
   ,FLDMODIFIEDBY  
   ,FLDMODIFIEDDATE  
  )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONCHECKITEMEVIDENCE  
 SELECT  
    T.FLDTOINSPECTIONCHECKITEMEVIDENCEID  
   ,T.FLDTOINSPECTIONCHECKITEMID  
   ,T.FLDEVIDENCENAME  
   ,FC.FLDSORTORDER  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
 FROM @TEMPCHECKITEMEVIDENCE T  
  INNER JOIN TBLINSPECTIONCHECKITEMEVIDENCE FC (NOLOCK)  
  ON T.FLDINSPECTIONCHECKITEMEVIDENCEID = FC.FLDINSPECTIONCHECKITEMEVIDENCEID  
 LEFT JOIN TBLINSPECTIONCHECKITEMEVIDENCE TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHECKITEMEVIDENCEID = TC.FLDINSPECTIONCHECKITEMEVIDENCEID  
 WHERE TC.FLDINSPECTIONCHECKITEMEVIDENCEID IS NULL  
  
  
 DECLARE @TEMPINSPECTIONOTHERDOCUMENTS TABLE   
 (  
     FLDINSPECTIONOTHERDOCUMENTSID        UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONOTHERDOCUMENTSID      UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONID              UNIQUEIDENTIFIER   
  ,FLDINSPECTIONOTHERDOCUMENTSNAME      VARCHAR(300)  
 )  
 INSERT INTO @TEMPINSPECTIONOTHERDOCUMENTS  
 (   
  FLDINSPECTIONOTHERDOCUMENTSID    
  ,FLDINSPECTIONID        
  ,FLDINSPECTIONOTHERDOCUMENTSNAME    
 )  
 SELECT   
   P.FLDINSPECTIONOTHERDOCUMENTSID    
  ,@TOINSPECTIONID       
  ,P.FLDINSPECTIONOTHERDOCUMENTSNAME   
 FROM  
 TBLINSPECTIONOTHERDOCUMENTS P (NOLOCK)  
 WHERE P.FLDINSPECTIONID = @INSPECTIONID  
  
 UPDATE T  
 SET   FLDTOINSPECTIONOTHERDOCUMENTSID = C.FLDINSPECTIONOTHERDOCUMENTSID  
 FROM @TEMPINSPECTIONOTHERDOCUMENTS T  
  INNER JOIN TBLINSPECTIONOTHERDOCUMENTS C (NOLOCK)  
   ON T.FLDINSPECTIONOTHERDOCUMENTSNAME = C.FLDINSPECTIONOTHERDOCUMENTSNAME  
    AND C.FLDINSPECTIONID = @TOINSPECTIONID  
 WHERE   T.FLDINSPECTIONOTHERDOCUMENTSNAME = C.FLDINSPECTIONOTHERDOCUMENTSNAME  
    AND C.FLDINSPECTIONID = @TOINSPECTIONID  
  
  
INSERT INTO TBLINSPECTIONOTHERDOCUMENTS  
  (  
    FLDINSPECTIONOTHERDOCUMENTSID  
   ,FLDINSPECTIONID  
   ,FLDINSPECTIONOTHERDOCUMENTSNAME  
   ,FLDATTACHMENTTYPE  
   ,FLDMANDATORYYN  
   ,FLDCREATEDBY  
   ,FLDCREATEDDATE  
   ,FLDMODIFIEDBY  
   ,FLDMODIFIEDDATE     
  )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONOTHERDOCUMENTS  
  SELECT   
    T.FLDTOINSPECTIONOTHERDOCUMENTSID  
   ,@TOINSPECTIONID  
   ,T.FLDINSPECTIONOTHERDOCUMENTSNAME  
   ,'PDF'  
   ,FC.FLDMANDATORYYN  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
  FROM @TEMPINSPECTIONOTHERDOCUMENTS T  
  INNER JOIN TBLINSPECTIONOTHERDOCUMENTS FC (NOLOCK)  
  ON T.FLDINSPECTIONOTHERDOCUMENTSID = FC.FLDINSPECTIONOTHERDOCUMENTSID  
 LEFT JOIN TBLINSPECTIONOTHERDOCUMENTS TC (NOLOCK)  
  ON T.FLDTOINSPECTIONOTHERDOCUMENTSID = TC.FLDINSPECTIONOTHERDOCUMENTSID  
 WHERE TC.FLDINSPECTIONOTHERDOCUMENTSID IS NULL  
  
     
--   ------11.INSPECTIONASSESMENTSTANDARD  
  
   DECLARE @TEMPINSPECTIONASSESMENTSTANDARD TABLE  
   (  
   FLDINSPECTIONASSESMENTSTANDARDID     UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONASSESMENTSTANDARDID   UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONID              UNIQUEIDENTIFIER   
  ,FLDASSESMENTSTANDARDNAME             VARCHAR(200)  
 )  
 INSERT INTO @TEMPINSPECTIONASSESMENTSTANDARD  
 (   
  FLDINSPECTIONASSESMENTSTANDARDID    
  ,FLDINSPECTIONID        
  ,FLDASSESMENTSTANDARDNAME    
 )  
 SELECT   
   P.FLDINSPECTIONASSESMENTSTANDARDID    
  ,P.FLDINSPECTIONID        
  ,P.FLDASSESMENTSTANDARDNAME   
 FROM  
 TBLINSPECTIONASSESMENTSTANDARD P (NOLOCK)  
 WHERE P.FLDINSPECTIONID = @INSPECTIONID  
  
 UPDATE T  
 SET   FLDTOINSPECTIONASSESMENTSTANDARDID = C.FLDINSPECTIONASSESMENTSTANDARDID  
 FROM @TEMPINSPECTIONASSESMENTSTANDARD T  
  INNER JOIN TBLINSPECTIONASSESMENTSTANDARD C (NOLOCK)  
   ON T.FLDASSESMENTSTANDARDNAME = C.FLDASSESMENTSTANDARDNAME  
   AND C.FLDINSPECTIONID = @TOINSPECTIONID  
 WHERE   T.FLDASSESMENTSTANDARDNAME = C.FLDASSESMENTSTANDARDNAME  
   AND C.FLDINSPECTIONID = @TOINSPECTIONID  
  
    
  
 INSERT INTO TBLINSPECTIONASSESMENTSTANDARD  
  (  
    FLDINSPECTIONASSESMENTSTANDARDID  
   ,FLDINSPECTIONID  
   ,FLDASSESMENTSTANDARDNAME  
   ,FLDSORTORDER  
   ,FLDCREATEDBY  
   ,FLDCREATEDDATE  
   ,FLDMODIFIEDBY  
   ,FLDMODIFIEDDATE  
  )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED.*INTO TBLAUDITINSPECTIONASSESMENTSTANDARD  
  SELECT  
    T.FLDTOINSPECTIONASSESMENTSTANDARDID  
   ,@TOINSPECTIONID  
   ,T.FLDASSESMENTSTANDARDNAME  
   ,FC.FLDSORTORDER  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
  FROM @TEMPINSPECTIONASSESMENTSTANDARD T  
  INNER JOIN TBLINSPECTIONASSESMENTSTANDARD FC (NOLOCK)  
  ON T.FLDINSPECTIONASSESMENTSTANDARDID = FC.FLDINSPECTIONASSESMENTSTANDARDID  
 LEFT JOIN TBLINSPECTIONASSESMENTSTANDARD TC (NOLOCK)  
  ON T.FLDTOINSPECTIONASSESMENTSTANDARDID = TC.FLDINSPECTIONASSESMENTSTANDARDID  
 WHERE TC.FLDINSPECTIONASSESMENTSTANDARDID IS NULL  
  
  
---------12.INSPECTIONACTIVITYCHECKITEMMAPPING  
  
    
DECLARE @TEMPACTIVITYCHECKITEMMAPPING TABLE   
 (  
   FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID   UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONACTIVITYCHECKITEMMAPPINGID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDEXTERNALINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID        UNIQUEIDENTIFIER   
  ,FLDREFERENCEID          INT  
  ,FLDTYPE                                   SMALLINT  
             
 )  
  
 INSERT INTO @TEMPACTIVITYCHECKITEMMAPPING  
 (   
  FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID      
 ,FLDREFERENCEID     
 ,FLDTYPE   
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID     
 ,P.FLDREFERENCEID     
 ,P.FLDTYPE   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
  
 FROM  
 TBLINSPECTIONACTIVITYCHECKITEMMAPPING P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
  
  
 UPDATE T  
 SET   FLDTOINSPECTIONACTIVITYCHECKITEMMAPPINGID   = C.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID  
 FROM @TEMPACTIVITYCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONACTIVITYCHECKITEMMAPPING C (NOLOCK)  
   ON T.FLDTYPE = C.FLDTYPE  
   AND T.FLDREFERENCEID = C.FLDREFERENCEID  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID=C.FLDEXTERNALINSPECTIONCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   AND C.FLDEXTERNALINSPECTIONCHECKITEMID=EC.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   
  
 INSERT INTO TBLINSPECTIONACTIVITYCHECKITEMMAPPING  
 (   
  FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID  
  ,FLDEXTERNALINSPECTIONCHECKITEMID  
  ,FLDREFERENCEID  
  ,FLDTYPE  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
  )  
  OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONACTIVITYCHECKITEMMAPPING  
  SELECT   
    T.FLDTOINSPECTIONACTIVITYCHECKITEMMAPPINGID  
            ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
            ,T.FLDREFERENCEID  
            ,T.FLDTYPE  
   ,@ROWUSERCODE   
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   FROM @TEMPACTIVITYCHECKITEMMAPPING T  
  INNER JOIN TBLINSPECTIONACTIVITYCHECKITEMMAPPING FC (NOLOCK)  
  ON T.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID = FC.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID  
 LEFT JOIN TBLINSPECTIONACTIVITYCHECKITEMMAPPING TC (NOLOCK)  
  ON T.FLDTOINSPECTIONACTIVITYCHECKITEMMAPPINGID = TC.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID  
 WHERE TC.FLDINSPECTIONACTIVITYCHECKITEMMAPPINGID IS NULL  
   
-- ------13.STANDARD PHOTO MAPPING  
  
 DECLARE @TEMPSTANDARDPHOTOMAPPING TABLE   
 (  
   FLDSTANDARDPHOTOMAPPINGID      UNIQUEIDENTIFIER  
  ,FLDTOSTANDARDPHOTOMAPPINGID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDINSPECTIONID        UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONID        UNIQUEIDENTIFIER  
  ,FLDINSPECTIONSTANDARDPHOTOID      UNIQUEIDENTIFIER  
  ,FLDINSPECTIONREVISIONID           UNIQUEIDENTIFIER   
             
 )  
 INSERT INTO @TEMPSTANDARDPHOTOMAPPING  
 (   
  FLDSTANDARDPHOTOMAPPINGID   
 ,FLDINSPECTIONID      
 ,FLDINSPECTIONSTANDARDPHOTOID     
 ,FLDINSPECTIONREVISIONID   
 ,FLDTOINSPECTIONID  
 )  
 SELECT   
  P.FLDSTANDARDPHOTOMAPPINGID    
 ,P.FLDINSPECTIONID       
 ,P.FLDINSPECTIONSTANDARDPHOTOID  
 ,P.FLDINSPECTIONREVISIONID   
 ,@TOINSPECTIONID  
 FROM  
 TBLINSPECTIONSTANDARDPHOTOMAPPING P (NOLOCK)  
 WHERE P.FLDINSPECTIONREVISIONID = @INSREVISIONID  
 AND P.FLDINSPECTIONID   = @INSPECTIONID   
  
  
  
  INSERT INTO TBLINSPECTIONSTANDARDPHOTOMAPPING  
   (  
     FLDSTANDARDPHOTOMAPPINGID  
    , FLDINSPECTIONID  
    , FLDINSPECTIONSTANDARDPHOTOID  
    , FLDCREATEDDATE  
    , FLDCREATEDBY  
    , FLDMODIFIEDDATE  
    , FLDMODIFIEDBY  
    , FLDINSPECTIONREVISIONID  
   )  
   OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONSTANDARDPHOTOMAPPING  
   SELECT  
      T.FLDTOSTANDARDPHOTOMAPPINGID  
    , @TOINSPECTIONID  
    , T.FLDINSPECTIONSTANDARDPHOTOID  
    , GETUTCDATE()  
    , @ROWUSERCODE  
    , GETUTCDATE()  
    , @ROWUSERCODE  
    , @TOINSREVISIONID    
   FROM @TEMPSTANDARDPHOTOMAPPING T  
    INNER JOIN TBLINSPECTIONSTANDARDPHOTOMAPPING FC (NOLOCK)  
     ON T.FLDSTANDARDPHOTOMAPPINGID = FC.FLDSTANDARDPHOTOMAPPINGID  
    LEFT JOIN TBLINSPECTIONSTANDARDPHOTOMAPPING TC (NOLOCK)  
     ON TC.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
     AND TC.FLDINSPECTIONID = @TOINSPECTIONID  
     AND T.FLDINSPECTIONSTANDARDPHOTOID = TC.FLDINSPECTIONSTANDARDPHOTOID  
 WHERE TC.FLDSTANDARDPHOTOMAPPINGID IS NULL  
  
 ----- 14 SUPDT JOB  
  
 DECLARE @TEMPSUPDTJOB TABLE   
 (  FLDCHECKITEMMAPPEDJOBID  UNIQUEIDENTIFIER  
   ,FLDTOCHECKITEMMAPPEDJOBID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDEXTERNALCHECKITEMID  UNIQUEIDENTIFIER  
   ,FLDTOEXTERNALCHECKITEMID     UNIQUEIDENTIFIER   
   ,FLDTOJOBID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDJOBID      UNIQUEIDENTIFIER  
      ,FLDPARAMETERNAME    VARCHAR (200)  
   ,FLDPARAMETERCODE             VARCHAR (20)  
   ,FLDJOBCODE     VARCHAR (50)  
      ,FLDJOBNAME     VARCHAR (200)  
 )  
   
 INSERT INTO @TEMPSUPDTJOB  
 (  
  FLDCHECKITEMMAPPEDJOBID   
 ,FLDEXTERNALCHECKITEMID  
 ,FLDPARAMETERNAME   
 ,FLDPARAMETERCODE  
 ,FLDJOBID  
 ,FLDJOBCODE      
 ,FLDJOBNAME   
 ,FLDTOEXTERNALCHECKITEMID  
 )  
 SELECT   
  P.FLDCHECKITEMMAPPEDJOBID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID  
 ,P.FLDPARAMETERNAME   
 ,P.FLDPARAMETERCODE  
 ,P.FLDJOBID    
 ,P.FLDJOBCODE      
 ,P.FLDJOBNAME   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM TBLINSPECTIONINSPECTORJOBS P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
  
 UPDATE T  
 SET FLDTOCHECKITEMMAPPEDJOBID  = C.FLDCHECKITEMMAPPEDJOBID  
  ,FLDTOJOBID          = C.FLDJOBID  
 FROM @TEMPSUPDTJOB T  
  INNER JOIN TBLINSPECTIONINSPECTORJOBS C (NOLOCK)  
   ON T.FLDPARAMETERNAME  = C.FLDPARAMETERNAME  
    AND T.FLDJOBNAME      = C.FLDJOBNAME  
    AND T.FLDTOEXTERNALCHECKITEMID=C.FLDEXTERNALCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
     
  
   INSERT INTO TBLINSPECTIONINSPECTORJOBS  
 (  
   FLDCHECKITEMMAPPEDJOBID      
  ,FLDEXTERNALCHECKITEMID    
  ,FLDCOMPONENTID  
  ,FLDCOMPONENTNUMBER  
  ,FLDCOMPONENTNAME  
  ,FLDJOBID  
  ,FLDJOBCODE  
  ,FLDJOBNAME  
  ,FLDPARAMETERCODE       
  ,FLDPARAMETERNAME       
  ,FLDISACTIVE        
  ,FLDCREATEDBY        
  ,FLDCREATEDDATE        
  ,FLDMODIFIEDBY        
  ,FLDMODIFIEDDATE       
  ,FLDPARAMETERTYPE  
  ,FLDISPARAMETER  
  ,FLDREQUIREDLASTDONEDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONINSPECTORJOBS  
 SELECT  
   T.FLDTOCHECKITEMMAPPEDJOBID   
  ,T.FLDTOEXTERNALCHECKITEMID    
  ,FC.FLDCOMPONENTID  
  ,FC.FLDCOMPONENTNUMBER  
  ,FC.FLDCOMPONENTNAME  
  ,T.FLDJOBID  
  ,T.FLDJOBCODE  
  ,T.FLDJOBNAME  
  ,T.FLDPARAMETERCODE      
  ,T.FLDPARAMETERNAME      
  ,FC.FLDISACTIVE       
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,FC.FLDPARAMETERTYPE  
  ,FC.FLDISPARAMETER  
  ,FC.FLDREQUIREDLASTDONEDATE  
   
   FROM @TEMPSUPDTJOB T  
  INNER JOIN TBLINSPECTIONINSPECTORJOBS FC (NOLOCK)  
  ON T.FLDCHECKITEMMAPPEDJOBID = FC.FLDCHECKITEMMAPPEDJOBID  
 LEFT JOIN TBLINSPECTIONINSPECTORJOBS TC (NOLOCK)  
  ON T.FLDTOCHECKITEMMAPPEDJOBID = TC.FLDCHECKITEMMAPPEDJOBID  
 WHERE TC.FLDCHECKITEMMAPPEDJOBID IS NULL  
   
   
 --- 15 TBLINSPECTIONLISTOFDOCUMENTS  
  
   
 DECLARE @TEMPLISTOFDOCUMENTS TABLE   
 (  FLDINSPECTIONDOCUMENTID  UNIQUEIDENTIFIER  
   ,FLDTOINSPECTIONDOCUMENTID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDEXTERNALCHECKITEMID  UNIQUEIDENTIFIER  
   ,FLDTOEXTERNALCHECKITEMID     UNIQUEIDENTIFIER   
      ,FLDDOCUMENTNAME     VARCHAR (200)  
 )  
   
 INSERT INTO @TEMPLISTOFDOCUMENTS  
 (  
  FLDINSPECTIONDOCUMENTID   
 ,FLDEXTERNALCHECKITEMID  
 ,FLDDOCUMENTNAME   
 ,FLDTOEXTERNALCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONDOCUMENTID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID  
 ,P.FLDDOCUMENTNAME   
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM TBLINSPECTIONLISTOFDOCUMENTS P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDINSPECTIONCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDINSPECTIONCHECKITEMID  
  
 UPDATE T  
 SET FLDTOINSPECTIONDOCUMENTID  = C.FLDINSPECTIONDOCUMENTID  
 FROM @TEMPLISTOFDOCUMENTS T  
  INNER JOIN TBLINSPECTIONLISTOFDOCUMENTS C (NOLOCK)  
   ON T.FLDDOCUMENTNAME  = C.FLDDOCUMENTNAME  
    AND T.FLDTOEXTERNALCHECKITEMID=C.FLDINSPECTIONCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALCHECKITEMID  
     
  
   INSERT INTO TBLINSPECTIONLISTOFDOCUMENTS  
 (  
   FLDINSPECTIONDOCUMENTID  
  ,FLDINSPECTIONCHECKITEMID  
  ,FLDDOCUMENTNAME  
  ,FLDNOTE  
  ,FLDSORTORDER        
  ,FLDCREATEDBY        
  ,FLDCREATEDDATE        
  ,FLDMODIFIEDBY        
  ,FLDMODIFIEDDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONLISTOFDOCUMENTS  
 SELECT  
   T.FLDTOINSPECTIONDOCUMENTID   
  ,T.FLDTOEXTERNALCHECKITEMID   
  ,FC.FLDDOCUMENTNAME  
  ,FC.FLDNOTE  
  ,FC.FLDSORTORDER   
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()   
   FROM @TEMPLISTOFDOCUMENTS T  
  INNER JOIN TBLINSPECTIONLISTOFDOCUMENTS FC (NOLOCK)  
  ON T.FLDINSPECTIONDOCUMENTID = FC.FLDINSPECTIONDOCUMENTID  
 WHERE T.FLDINSPECTIONDOCUMENTID = FC.FLDINSPECTIONDOCUMENTID  
   
  ------17. TBLINSPECTIONCHECKSCONFIGURATION  
  DECLARE @TEMPCHECKSCONFIGURATION TABLE  
  (  
   FLDINSPECTIONCHECKSCONFIGURATIONID  UNIQUEIDENTIFIER  
   ,FLDTOINSPECTIONCHECKSCONFIGURATIONID  UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDINSPECTIONREVISIONID     UNIQUEIDENTIFIER   
   ,FLDTOINSPECTIONREVISIONID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDTOCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDCHAPTERIDREVISIONID      UNIQUEIDENTIFIER   
   ,FLDTOCHAPTERIDREVISIONID     UNIQUEIDENTIFIER  
   ,FLDTYPE         INT  
   ,FLDGROUPID         INT  
  )  
  
 INSERT INTO @TEMPCHECKSCONFIGURATION  
 (   
  FLDINSPECTIONCHECKSCONFIGURATIONID   
 ,FLDINSPECTIONREVISIONID      
 ,FLDCHAPTERID     
 ,FLDCHAPTERIDREVISIONID     
 ,FLDTOCHAPTERID  
 ,FLDTOCHAPTERIDREVISIONID  
 ,FLDTOINSPECTIONREVISIONID  
 ,FLDTYPE  
 ,FLDGROUPID  
 )  
 SELECT   
  E.FLDINSPECTIONCHECKSCONFIGURATIONID   
 ,E.FLDINSPECTIONREVISIONID      
 ,E.FLDCHAPTERID     
 ,E.FLDCHAPTERREVISIONID        
 ,T.FLDTOCHAPTERID  
 ,T.FLDTOCHAPTERREVISIONID  
 ,@TOINSREVISIONID  
 ,E.FLDTYPE  
 ,E.FLDGROUPID  
 FROM TBLINSPECTIONCHECKSCONFIGURATION E (NOLOCK)  
  LEFT JOIN @TEMPCHAPTER T   
   ON E.FLDCHAPTERID = T.FLDCHAPTERID  
   AND E.FLDCHAPTERREVISIONID = T.FLDCHAPTERREVISIONID  
 WHERE  E.FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
 UPDATE T  
 SET  FLDTOINSPECTIONCHECKSCONFIGURATIONID  = C.FLDINSPECTIONCHECKSCONFIGURATIONID  
 FROM @TEMPCHECKSCONFIGURATION T  
  INNER JOIN TBLINSPECTIONCHECKSCONFIGURATION C (NOLOCK)  
   ON C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
   AND ISNULL(T.FLDTOCHAPTERIDREVISIONID,'00000000-0000-0000-0000-000000000000') = ISNULL(C.FLDCHAPTERREVISIONID,'00000000-0000-0000-0000-000000000000')  
   AND  C.FLDTYPE     = T.FLDTYPE  
   AND  C.FLDGROUPID    = T.FLDGROUPID  
 WHERE C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
 AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
 AND  T.FLDTOCHAPTERID   = C.FLDCHAPTERID  
  
 INSERT INTO TBLINSPECTIONCHECKSCONFIGURATION  
 (  
  FLDINSPECTIONCHECKSCONFIGURATIONID  
  ,FLDINSPECTIONID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDCHAPTERID  
  ,FLDCHAPTERREVISIONID  
  ,FLDTYPE  
  ,FLDGROUPID  
  ,FLDGROUPNAME  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONCHECKSCONFIGURATION  
 SELECT T.FLDTOINSPECTIONCHECKSCONFIGURATIONID  
  ,@TOINSPECTIONID  
  ,T.FLDTOINSPECTIONREVISIONID  
  ,T.FLDTOCHAPTERID  
  ,T.FLDTOCHAPTERIDREVISIONID  
  ,FC.FLDTYPE  
  ,FC.FLDGROUPID  
  ,FC.FLDGROUPNAME  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
 FROM @TEMPCHECKSCONFIGURATION  T  
  INNER JOIN TBLINSPECTIONCHECKSCONFIGURATION FC (NOLOCK)  
  ON T.FLDINSPECTIONCHECKSCONFIGURATIONID = FC.FLDINSPECTIONCHECKSCONFIGURATIONID  
 LEFT JOIN TBLINSPECTIONCHECKSCONFIGURATION TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHECKSCONFIGURATIONID = TC.FLDINSPECTIONCHECKSCONFIGURATIONID  
 WHERE TC.FLDINSPECTIONCHECKSCONFIGURATIONID IS NULL  
    
  ------18. TBLINSPECTIONCHAPTERMULTIPLECHECKS  
  
  DECLARE @TEMPCHAPTERMULTIPLECHECKS TABLE  
  (  
   FLDINSPECTIONCHAPTERMULTIPLECHECKSID  UNIQUEIDENTIFIER  
   ,FLDTOINSPECTIONCHAPTERMULTIPLECHECKSID  UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDINSPECTIONREVISIONID     UNIQUEIDENTIFIER   
   ,FLDTOINSPECTIONREVISIONID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDTOCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDCHAPTERIDREVISIONID      UNIQUEIDENTIFIER   
   ,FLDTOCHAPTERIDREVISIONID     UNIQUEIDENTIFIER  
   ,FLDSORTORDER        INT  
  )  
  
 INSERT INTO @TEMPCHAPTERMULTIPLECHECKS  
 (   
  FLDINSPECTIONCHAPTERMULTIPLECHECKSID   
 ,FLDINSPECTIONREVISIONID      
 ,FLDCHAPTERID     
 ,FLDCHAPTERIDREVISIONID     
 ,FLDTOCHAPTERID  
 ,FLDTOCHAPTERIDREVISIONID  
 ,FLDTOINSPECTIONREVISIONID  
 ,FLDSORTORDER  
 )  
 SELECT   
  E.FLDINSPECTIONCHAPTERMULTIPLECHECKSID   
 ,E.FLDINSPECTIONREVISIONID      
 ,E.FLDCHAPTERID     
 ,E.FLDCHAPTERREVISIONID        
 ,T.FLDTOCHAPTERID  
 ,T.FLDTOCHAPTERREVISIONID  
 ,@TOINSREVISIONID  
 ,E.FLDSORTORDER  
 FROM TBLINSPECTIONCHAPTERMULTIPLECHECKS E (NOLOCK)    INNER JOIN @TEMPCHAPTER T   
   ON E.FLDCHAPTERID = T.FLDCHAPTERID  
   AND E.FLDCHAPTERREVISIONID = T.FLDCHAPTERREVISIONID  
 WHERE  FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
 UPDATE T  
 SET  FLDTOINSPECTIONCHAPTERMULTIPLECHECKSID  = C.FLDINSPECTIONCHAPTERMULTIPLECHECKSID  
 FROM @TEMPCHAPTERMULTIPLECHECKS T  
  INNER JOIN TBLINSPECTIONCHAPTERMULTIPLECHECKS C (NOLOCK)  
   ON T.FLDTOCHAPTERID = C.FLDCHAPTERID  
   AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
   AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
   AND  C.FLDSORTORDER      = T.FLDSORTORDER   
 WHERE T.FLDTOCHAPTERID = C.FLDCHAPTERID  
 AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
 AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  
 INSERT INTO TBLINSPECTIONCHAPTERMULTIPLECHECKS  
 (  
  FLDINSPECTIONCHAPTERMULTIPLECHECKSID  
  ,FLDINSPECTIONID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDCHAPTERID  
  ,FLDCHAPTERREVISIONID  
  ,FLDTITLENAME  
  ,FLDSORTORDER  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONCHAPTERMULTIPLECHECKS  
 SELECT T.FLDTOINSPECTIONCHAPTERMULTIPLECHECKSID  
  ,@TOINSPECTIONID  
  ,T.FLDTOINSPECTIONREVISIONID  
  ,T.FLDTOCHAPTERID  
  ,T.FLDTOCHAPTERIDREVISIONID  
  ,FC.FLDTITLENAME  
  ,FC.FLDSORTORDER  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
 FROM @TEMPCHAPTERMULTIPLECHECKS  T  
  INNER JOIN TBLINSPECTIONCHAPTERMULTIPLECHECKS FC (NOLOCK)  
  ON T.FLDINSPECTIONCHAPTERMULTIPLECHECKSID = FC.FLDINSPECTIONCHAPTERMULTIPLECHECKSID  
 LEFT JOIN TBLINSPECTIONCHAPTERMULTIPLECHECKS TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHAPTERMULTIPLECHECKSID = TC.FLDINSPECTIONCHAPTERMULTIPLECHECKSID  
 WHERE TC.FLDINSPECTIONCHAPTERMULTIPLECHECKSID IS NULL  
   
 ------19. TBLINSPECTIONCHAPTERMAPPING  
  DECLARE @TEMPCHAPTERMAPPING TABLE  
  (  
   FLDINSPECTIONCHAPTERMAPPINGID    UNIQUEIDENTIFIER  
   ,FLDTOINSPECTIONCHAPTERMAPPINGID   UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDINSPECTIONREVISIONID     UNIQUEIDENTIFIER   
   ,FLDTOINSPECTIONREVISIONID     UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
   ,FLDCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDTOCHAPTERID        UNIQUEIDENTIFIER  
   ,FLDCHAPTERIDREVISIONID      UNIQUEIDENTIFIER   
   ,FLDTOCHAPTERIDREVISIONID     UNIQUEIDENTIFIER  
   ,FLDTYPE         INT  
   ,FLDREFERENCEID        UNIQUEIDENTIFIER  
  )   
  
 INSERT INTO @TEMPCHAPTERMAPPING  
 (   
  FLDINSPECTIONCHAPTERMAPPINGID   
 ,FLDINSPECTIONREVISIONID      
 ,FLDCHAPTERID     
 ,FLDCHAPTERIDREVISIONID     
 ,FLDTOCHAPTERID  
 ,FLDTOCHAPTERIDREVISIONID  
 ,FLDTOINSPECTIONREVISIONID  
 ,FLDTYPE  
 ,FLDREFERENCEID  
 )  
 SELECT   
  E.FLDINSPECTIONCHAPTERMAPPINGID   
 ,E.FLDINSPECTIONREVISIONID      
 ,E.FLDCHAPTERID     
 ,E.FLDCHAPTERREVISIONID        
 ,T.FLDTOCHAPTERID  
 ,T.FLDTOCHAPTERREVISIONID  
 ,@TOINSREVISIONID  
 ,E.FLDTYPE  
 ,E.FLDREFERENCEID  
 FROM TBLINSPECTIONCHAPTERMAPPING E (NOLOCK)  
  INNER JOIN @TEMPCHAPTER T   
   ON E.FLDCHAPTERID = T.FLDCHAPTERID  
   AND E.FLDCHAPTERREVISIONID = T.FLDCHAPTERREVISIONID  
 WHERE  FLDINSPECTIONREVISIONID = @INSREVISIONID  
  
 UPDATE T  
 SET  FLDTOINSPECTIONCHAPTERMAPPINGID  = C.FLDINSPECTIONCHAPTERMAPPINGID  
 FROM @TEMPCHAPTERMAPPING T  
  INNER JOIN TBLINSPECTIONCHAPTERMAPPING C (NOLOCK)  
   ON T.FLDTOCHAPTERID = C.FLDCHAPTERID  
   AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
   AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
   AND  C.FLDTYPE      = T.FLDTYPE  
   AND  C.FLDREFERENCEID    = T.FLDREFERENCEID  
 WHERE T.FLDTOCHAPTERID = C.FLDCHAPTERID  
 AND T.FLDTOCHAPTERIDREVISIONID = C.FLDCHAPTERREVISIONID  
 AND  C.FLDINSPECTIONREVISIONID = @TOINSREVISIONID  
  
 INSERT INTO TBLINSPECTIONCHAPTERMAPPING  
 (  
  FLDINSPECTIONCHAPTERMAPPINGID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDCHAPTERID  
  ,FLDCHAPTERREVISIONID  
  ,FLDTYPE  
  ,FLDREFERENCEID  
  ,FLDNAME  
  ,FLDCREATEDBY  
  ,FLDCREATEDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
 )  
 OUTPUT 0,@ROWUSERCODE,GETUTCDATE(),OBJECT_NAME(@@PROCID),NULL,INSERTED. * INTO TBLAUDITINSPECTIONCHAPTERMAPPING  
 SELECT T.FLDTOINSPECTIONCHAPTERMAPPINGID  
  ,T.FLDTOINSPECTIONREVISIONID  
  ,T.FLDTOCHAPTERID  
  ,T.FLDTOCHAPTERIDREVISIONID  
  ,FC.FLDTYPE  
  ,FC.FLDREFERENCEID  
  ,FC.FLDNAME  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
  ,@ROWUSERCODE  
  ,GETUTCDATE()  
 FROM @TEMPCHAPTERMAPPING  T  
  INNER JOIN TBLINSPECTIONCHAPTERMAPPING FC (NOLOCK)  
  ON T.FLDINSPECTIONCHAPTERMAPPINGID = FC.FLDINSPECTIONCHAPTERMAPPINGID  
 LEFT JOIN TBLINSPECTIONCHAPTERMAPPING TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHAPTERMAPPINGID = TC.FLDINSPECTIONCHAPTERMAPPINGID  
 WHERE TC.FLDINSPECTIONCHAPTERMAPPINGID IS NULL  
    
 ------20. TBLINSPECTIONCHECKLISTMULTIPLEUNITS  
  
   
    
DECLARE @TEMPCHECKLISTMULTIPLEUNITS TABLE   
 (  
   FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONCHECKLISTMULTIPLEUNITSID UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDEXTERNALINSPECTIONCHECKITEMID   UNIQUEIDENTIFIER   
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID        UNIQUEIDENTIFIER   
  ,FLDSORTORDER        INT  
             
 )  
  
 INSERT INTO @TEMPCHECKLISTMULTIPLEUNITS  
 (   
  FLDINSPECTIONCHECKLISTMULTIPLEUNITSID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID      
 ,FLDSORTORDER   
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID     
 ,P.FLDSORTORDER  
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM  
 TBLINSPECTIONCHECKLISTMULTIPLEUNITS P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALINSPECTIONCHECKITEMID  
  
  
 UPDATE T  
 SET   FLDTOINSPECTIONCHECKLISTMULTIPLEUNITSID   = C.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  
 FROM @TEMPCHECKLISTMULTIPLEUNITS T  
  INNER JOIN TBLINSPECTIONCHECKLISTMULTIPLEUNITS C (NOLOCK)  
   ON T.FLDSORTORDER = C.FLDSORTORDER  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID=C.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   AND C.FLDEXTERNALINSPECTIONCHECKITEMID=EC.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   
  
 INSERT INTO TBLINSPECTIONCHECKLISTMULTIPLEUNITS  
 (   
  FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  
  ,FLDINSPECTIONID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDEXTERNALINSPECTIONCHECKITEMID  
  ,FLDUNITNAME  
  ,FLDSORTORDER  
  ,FLDCREATEDBY  
  ,FLDCREATEDDATE  
  ,FLDMODIFIEDBY  
  ,FLDMODIFIEDDATE  
  )  
  OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONCHECKLISTMULTIPLEUNITS  
  SELECT   
    T.FLDTOINSPECTIONCHECKLISTMULTIPLEUNITSID  
   ,@TOINSPECTIONID  
   ,@TOINSREVISIONID  
            ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
            ,FC.FLDUNITNAME  
            ,FC.FLDSORTORDER  
   ,@ROWUSERCODE   
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   FROM @TEMPCHECKLISTMULTIPLEUNITS T  
  INNER JOIN TBLINSPECTIONCHECKLISTMULTIPLEUNITS FC (NOLOCK)  
  ON T.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID = FC.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  
 LEFT JOIN TBLINSPECTIONCHECKLISTMULTIPLEUNITS TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHECKLISTMULTIPLEUNITSID = TC.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID  
 WHERE TC.FLDINSPECTIONCHECKLISTMULTIPLEUNITSID IS NULL  
    
    
  ------21. TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING  
          
    
 DECLARE @TEMPCHAPTERSTANDARDPHOTOMAPPING TABLE   
 (  
   FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  UNIQUEIDENTIFIER  
  ,FLDTOINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  UNIQUEIDENTIFIER DEFAULT(NEWSEQUENTIALID())  
  ,FLDEXTERNALINSPECTIONCHECKITEMID     UNIQUEIDENTIFIER   
  ,FLDTOEXTERNALINSPECTIONCHECKITEMID    UNIQUEIDENTIFIER   
  ,FLDINSPECTIONSTANDARDPHOTOID      UNIQUEIDENTIFIER  
             
 )  
  
 INSERT INTO @TEMPCHAPTERSTANDARDPHOTOMAPPING  
 (   
  FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID   
 ,FLDEXTERNALINSPECTIONCHECKITEMID      
 ,FLDINSPECTIONSTANDARDPHOTOID   
 ,FLDTOEXTERNALINSPECTIONCHECKITEMID  
 )  
 SELECT   
  P.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID   
 ,C.FLDEXTERNALINSPECTIONCHECKITEMID     
 ,P.FLDINSPECTIONSTANDARDPHOTOID  
 ,C.FLDTOEXTERNALINSPECTIONCHECKITEMID  
 FROM  
 TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING P (NOLOCK)  
 INNER JOIN @TEMPCHECKLIST C  
 ON C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
 WHERE C.FLDEXTERNALINSPECTIONCHECKITEMID=P.FLDEXTERNALCHECKITEMID  
  
  
 UPDATE T  
 SET   FLDTOINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID   = C.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  
 FROM @TEMPCHAPTERSTANDARDPHOTOMAPPING T  
  INNER JOIN TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING C (NOLOCK)  
   ON T.FLDINSPECTIONSTANDARDPHOTOID = C.FLDINSPECTIONSTANDARDPHOTOID  
   AND T.FLDTOEXTERNALINSPECTIONCHECKITEMID=C.FLDEXTERNALCHECKITEMID  
  INNER JOIN @TEMPCHECKLIST EC  
         ON EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   AND C.FLDEXTERNALCHECKITEMID=EC.FLDEXTERNALINSPECTIONCHECKITEMID  
 WHERE  EC.FLDEXTERNALINSPECTIONCHECKITEMID=T.FLDEXTERNALINSPECTIONCHECKITEMID  
   
  
 INSERT INTO TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING  
 (   
  FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  
  ,FLDINSPECTIONID  
  ,FLDINSPECTIONREVISIONID  
  ,FLDEXTERNALCHECKITEMID  
  ,FLDINSPECTIONSTANDARDPHOTOID  
  ,FLDCREATEDDATE  
  ,FLDCREATEDBY  
  ,FLDMODIFIEDDATE  
  ,FLDMODIFIEDBY  
  )  
  OUTPUT 0, @ROWUSERCODE, GETUTCDATE(), OBJECT_NAME(@@PROCID), NULL,INSERTED.* INTO TBLAUDITINSPECTIONCHAPTERSTANDARDPHOTOMAPPING  
  SELECT   
    T.FLDTOINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  
   ,@TOINSPECTIONID  
   ,@TOINSREVISIONID  
            ,T.FLDTOEXTERNALINSPECTIONCHECKITEMID  
            ,FC.FLDINSPECTIONSTANDARDPHOTOID  
   ,GETUTCDATE()  
   ,@ROWUSERCODE  
   ,GETUTCDATE()  
   ,@ROWUSERCODE   
 FROM @TEMPCHAPTERSTANDARDPHOTOMAPPING T  
  INNER JOIN TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING FC (NOLOCK)  
  ON T.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID = FC.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  
 LEFT JOIN TBLINSPECTIONCHAPTERSTANDARDPHOTOMAPPING TC (NOLOCK)  
  ON T.FLDTOINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID = TC.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID  
 WHERE TC.FLDINSPECTIONCHAPTERSTANDARDPHOTOMAPPINGID IS NULL  
  
  
  
END
